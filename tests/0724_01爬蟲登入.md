### å…ˆæŠŠåè©è¬›æ¸…æ¥š

| åè©                | åœ¨â€¯Playwrightâ€¯è£¡ä»£è¡¨ä»€éº¼                                                      | è·Ÿä½ ç¾åœ¨çš„ `auth.json` é—œä¿‚                                                        |
| ----------------- | ----------------------------------------------------------------------- | --------------------------------------------------------------------------- |
| **Cookie**        | ç€è¦½å™¨å­˜çš„ `cookies` æ¬„ä½                                                      | `auth.json` è£¡æœ‰                                                              |
| **storageâ€¯state** | **Playwright** æä¾›çš„åºåˆ—åŒ–æ ¼å¼ï¼Œé™¤äº† cookiesï¼Œé‚„å« **localStorage / sessionStorage** | ä½ ç”¨ `ctx.storage_state(path="auth.json")` å­˜å‡ºçš„æª”æ¡ˆï¼Œå…¶å¯¦å°±æ˜¯ *ä¸€ä»½ storageâ€¯state JSON* |
| **auth.json**     | åªæ˜¯ä½ å¹« storageâ€¯state å–çš„æª”å                                                 | ï¼ storage\_state ï¼ cookies+localStorage                                     |

> **æ‰€ä»¥**ï¼šã€Œå®¢æˆ¶ä¸Šå‚³ cookie / storage\_stateã€ï¼ã€Œå®¢æˆ¶æŠŠ *auth.json* ä¸Šå‚³çµ¦æˆ‘å€‘ã€â€”â€”æœ¬è³ªåŒä¸€ä»¶äº‹ï¼Œåªæ˜¯æˆ‘ç”¨æ¯”è¼ƒé€šç”¨çš„èªªæ³•ã€‚

---

## å…©ç¨®æœ€ç°¡å–®çš„äº¤ä»˜æµç¨‹

### æµç¨‹Â Aâ”€â”€è®“å®¢æˆ¶è‡ªå·±è·‘ä¸€æ¬¡ `save_auth.py`

1. å®¢æˆ¶ clone ä½ çš„ repoï¼ŒåŸ·è¡Œ

   ```bash
   python save_auth.py     # Playwright æœƒé–‹å•ŸçœŸç€è¦½å™¨
   ```
2. **æ‰‹å‹•ç™»å…¥ Threads/IG** â†’ é—œçª—
3. ç”¢ç”Ÿ `auth.json` â†’ å®¢æˆ¶æŠŠæª”æ¡ˆå‚³çµ¦ä½ ï¼ˆæˆ–ä¸Šå‚³å‰ç«¯ï¼‰
4. ä¹‹å¾Œæ‰€æœ‰çˆ¬èŸ²ä»»å‹™éƒ½åªè¦å¸¶é€™å€‹ `auth.json`ï¼Œå®Œå…¨ **ä¸ç”¨å†ç™»å…¥**ã€‚

**å„ªé»**ï¼šæœ€å°‘é–‹ç™¼é‡ã€‚
**ç¼ºé»**ï¼šå®¢æˆ¶æœ¬åœ°è¦å®‰è£ Python + Playwrightï¼Œå°éæŠ€è¡“ä½¿ç”¨è€…éº»ç…©ã€‚

---

### æµç¨‹Â Bâ”€â”€ç”±æœå‹™ç«¯é ç«¯å¹«å®¢æˆ¶ç™»å…¥ä¸€æ¬¡ï¼ˆå‰ç«¯å‹å–„ï¼‰

> åšä¸€å€‹ã€Œ**ä¸€éµæˆæ¬Š**ã€é é¢ï¼Œæ­¥é©Ÿè·Ÿ Google OAuth å¾ˆåƒï¼Œä½†å¯¦éš›ä¸Šæ˜¯æˆ‘å€‘é–‹ä¸€å€‹æš«æ™‚æ€§çš„ PlaywrightÂ browser è®“å®¢æˆ¶è‡ªå·±è¼¸å…¥å¯†ç¢¼ã€‚

1. å‰ç«¯æŒ‰ã€Œé–‹å§‹æˆæ¬Šã€â†’ ä¼ºæœå™¨èµ·ä¸€å€‹ **å¸¶ UI çš„æš«æ™‚ç€è¦½å™¨**ï¼ˆ`launch(headless=False)` æˆ–ç”¨ [playwright-web](https://github.com/microsoft/playwright-web)ï¼‰ã€‚
2. é€é **WebRTC / VNC** æŠŠç€è¦½å™¨ç•«é¢ä¸²æµçµ¦å®¢æˆ¶ï¼Œè®“å®¢æˆ¶è‡ªå·±åœ¨é›²ç«¯ç€è¦½å™¨è£¡ç™»å…¥ã€‚
3. ç™»å…¥æˆåŠŸâ†’ å¾Œç«¯å‘¼å« `context.storage_state()` å­˜æˆ `auth.json`ï¼Œç”¨ **AES + KMS** åŠ å¯†å¾Œä¸Ÿ S3ã€‚
4. å®¢æˆ¶ç€è¦½å™¨é—œæ‰â†’ å‰ç«¯æ”¶åˆ°ã€Œæˆæ¬Šå®Œæˆã€â†’ é¡¯ç¤º credential\_idã€‚
5. å¾€å¾Œçˆ¬èŸ² Worker ä¸‹è¼‰ä¸¦è§£å¯† `auth.json` ä½¿ç”¨ï¼ˆ**ç´” headless æ¨¡å¼**ï¼‰ã€‚

**å„ªé»**ï¼šå®¢æˆ¶ç«¯é›¶å®‰è£ï¼Œé«”é©—åƒç”¨é›²ç«¯ç€è¦½å™¨ã€‚
**ç¼ºé»**ï¼šä½ å¾—å¯¦ä½œç•«é¢ä¸²æµæˆ–ç”¨ç¾æˆçš„ã€ŒBrowserâ€‘asâ€‘aâ€‘Serviceã€ï¼ˆe.g. Browserlessã€LambdaTestï¼‰ä¸¦è™•ç†å®‰å…¨æ²™ç®±ã€‚

---

## ç‚ºä»€éº¼æˆ‘ä¹‹å‰èªªã€Œä¸Šå‚³ cookie / storage\_stateã€ï¼Ÿ

* **å¤šç§Ÿæˆ¶**æœå‹™æ™‚ï¼Œç¬¬ä¸€å€‹ user ä¸æœƒæŠŠ `auth.json` æ”¾åˆ°å°ˆæ¡ˆè³‡æ–™å¤¾å† PR çµ¦ä½  ğŸ˜‚
* é€šå¸¸æœƒæä¾›ä¸€å€‹ã€Œæ†‘è­‰ç®¡ç†ã€ä»‹é¢ï¼š
  ã€Œ**æ–°å¢ Threads æ†‘è­‰** â†’ é¸æ“‡ `auth.json` æª” â†’ ç³»çµ±åŠ å¯†å¾Œå­˜é›²ç«¯ â†’ å›å‚³ `credential_id`ã€
  å¾ŒçºŒä¸‹çˆ¬èŸ²ä»»å‹™åªå‚³ `credential_id`ï¼ŒWorker è‡ªå·±å»æŠ“æª”æ¡ˆã€‚

> é€™æ¨£æ—¢å®‰å…¨åˆèƒ½ä¸€æ¬¡æœå‹™å¾ˆå¤šå®¢æˆ¶ï¼Œæ¯å€‹äººä¸€ä»½åŠ å¯† storage\_stateã€‚

---

## ä½ å¦‚æœåªæƒ³å…ˆè·‘å¾—é€šï¼Œæœ€å°ç‰ˆæœ¬å¯ä»¥é€™æ¨£

1. **é‚„æ˜¯ç¶­æŒ `save_auth.py`**ï¼›æ•™å®¢æˆ¶ cloneã€ç™»å…¥ã€æŠŠ `auth.json` å¯„çµ¦ä½ ã€‚
2. FastAPI `POST /jobs` å¤šä¸€å€‹ `multipart/form-data` æ¬„ä½ `auth_file`ï¼Œç›´æ¥æŠŠæª”æ¡ˆè·Ÿç›®æ¨™å¸³è™Ÿä¸€èµ·å‚³ã€‚
3. Worker æŠŠæ”¶åˆ°çš„æª”æ¡ˆå­˜åˆ° `/tmp/{job_id}.json`ï¼Œå‚³çµ¦ Playwrightã€‚
4. ä»»å‹™çµæŸå³åˆªæª”ã€‚

ç­‰ä¸Šç·šå¾Œï¼Œå†æ…¢æ…¢å‡ç´šæˆã€Œé›²ç«¯ä¸€éµç™»å…¥ + credential ç®¡ç†ã€ã€‚

---

### ç¸½çµ

* **storage\_state/cookies/auth.json å®Œå…¨æ˜¯åŒä¸€å€‹æ±è¥¿**ï¼Œåªæ˜¯å«æ³•ä¸åŒã€‚
* å®¢æˆ¶ **å¯ä»¥** å…ˆè‡ªå·±è·‘ä¸€æ¬¡ç™»å…¥è…³æœ¬ï¼Œä¹Ÿ **å¯ä»¥** é€éä½ æä¾›çš„é›²ç«¯ç€è¦½å™¨ä¾†ç™»å…¥ï¼›éƒ½æœƒå¾—åˆ° `auth.json`ã€‚
* ä½ çš„çˆ¬èŸ²åªè¦æ‹¿åˆ°é€™å€‹æª”æ¡ˆå°±èƒ½ç„¡ç—›æŠ“è¶…é 25â€¯å‰‡ï¼Œæ•´å€‹æœå‹™å±¤åªæ˜¯åœ¨ **å®‰å…¨åœ°æ”¶æª” â†’ å®‰å…¨åœ°ç”¨æª”**ã€‚

å¦‚æœè¦çœ‹å“ªä¸€æ®µç¨‹å¼ç¢¼æ€éº¼æ”¹æˆ–æƒ³è¦ sampleÂ API/å‰ç«¯é é¢ç¯„ä¾‹ï¼Œè·Ÿæˆ‘èªªä¸€è²ï¼


####################

> **ç°¡ç­”**
> å¯ä»¥ï¼Œä½†è¦æ¬Šè¡¡â€¯**ã€Œæ–¹ä¾¿ã€**â€¯vsâ€¯**ã€Œå¸³è™Ÿé¢¨éšªã€**ã€‚
> åªè¦ä½ é¡˜æ„æŠŠ **å¸³å¯†**ï¼ˆç”šè‡³ 2FA tokenï¼‰äº¤çµ¦å¾Œç«¯ï¼ŒPlaywright ç•¶ç„¶èƒ½è‡ªå‹•æ‰“é–‹é›²ç«¯ç€è¦½å™¨ â†’ å¹«ä½ è¼¸å…¥ â†’ å„²å­˜ `auth.json`ï¼Œæ•´å€‹æµç¨‹ 100â€¯% è‡ªå‹•åŒ–ã€‚é—œéµæ˜¯ **å®‰å…¨é¢¨éšªã€å°è™Ÿé¢¨éšª** ä½ èƒ½ä¸èƒ½æ¥å—ï¼Œä»¥åŠä½ æƒ³æ€éº¼ä¿è­·é€™äº›æ†‘è­‰ã€‚

ä¸‹é¢åˆ†ä¸‰å¡Šèªªæ¸…æ¥šï¼š

---

## 1â€¯|â€¯æŠ€è¡“ä¸Šæ€éº¼åš

```python
# pseudoâ€‘codeï¼šä¸€éµç™»å…¥ä¸¦è¼¸å‡º auth.json
async def login_and_save(username, password, totp_secret=None):
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=True)      # headless ä¹Ÿè¡Œ
        ctx = await browser.new_context()
        page = await ctx.new_page()

        await page.goto("https://www.threads.com/")

        # 1. è¼¸å…¥å¸³å¯†
        await page.fill('input[name="username"]', username)
        await page.fill('input[name="password"]', password)
        await page.click('button[type="submit"]')

        # 2. è‹¥é–‹å•Ÿ 2FAï¼ˆTOTPï¼‰
        if totp_secret:
            code = generate_totp(totp_secret)                 # ç”¨ pyotp
            await page.fill('input[name="verificationCode"]', code)
            await page.click('button[type="submit"]')

        # 3. ç­‰ç™»å…¥å®Œæˆ
        await page.wait_for_selector('text="Home"', timeout=15000)

        # 4. å­˜ storage_state
        await ctx.storage_state(path="auth.json")
        await browser.close()
```

* **å¸³å¯†**ã€(**å¯é¸**)â€¯TOTPÂ secret å…¨éƒ½ç¨‹å¼å¡ã€‚
* åªè·‘ä¸€æ¬¡å°±æœƒæ‹¿åˆ°å’Œæ‰‹å‹•å®Œå…¨ç›¸åŒçš„ `auth.json`ã€‚
* ä¹‹å¾Œç…§èˆŠï¼š`ctx = browser.new_context(storage_state="auth.json")` æŠ“è²¼æ–‡ã€‚

---

## 2â€¯|â€¯å®‰å…¨ & åˆè¦é‡é»

| é¢¨éšª           | é¢¨éšªé»                                     | ç·©è§£ä½œæ³•                                                                                      |
| ------------ | --------------------------------------- | ----------------------------------------------------------------------------------------- |
| **å¸³è™Ÿå°é–/é©—è­‰**  | Threads / IG å°è‡ªå‹•åŒ–ç™»å…¥ç•°å¸¸æ•æ„Ÿï¼ˆIPã€Headlessã€é »ç‡ï¼‰ | - **æœ‰é ­æ¨¡å¼**+çœŸç€è¦½å™¨ UA<br>- ä½é »ç‡ã€äººæ©Ÿæ··æµ<br>- IP ç¶å®šæˆ–ä½¿ç”¨ residential proxy                          |
| **å¸³å¯†å¤–æ´©**     | å¾Œç«¯å¿…é ˆå­˜å–æ˜æ–‡å¸³å¯† / TOTP                       | - å‰ç«¯ç”¨ **ä¸€æ¬¡æ€§åŠ å¯†** ä¸Šå‚³ (ex.Â AES) â†’ å¾Œç«¯åœ¨ sandbox è‡¨æ™‚è§£å¯†<br>- ç™»å…¥å¾Œç«‹å³éŠ·æ¯€æ˜æ–‡<br>- é•·æœŸåªç•™ä¸‹åŠ å¯†å¾Œçš„ `auth.json` |
| **æ³•éµ / ToS** | è‡ªå‹•åŒ–ç™»å…¥é•å InstagramÂ ToS                   | - è·Ÿå®¢æˆ¶ç°½ç´„ï¼šä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ“”é¢¨éšª<br>- æˆ–æ”¹èµ°Â **Meta Graph API**ï¼ˆä½†ç›®å‰ Threads æ²’å…¬é–‹ï¼‰                            |

---

## 3â€¯|â€¯å¦‚ä½•æ¥åˆ°ä½ ç¾æœ‰ã€Œæµç¨‹â€¯Bã€

```
â”Œâ”€(1) å‰ç«¯è¨­å®šé â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ è¼¸å…¥ username / password / TOTP â”‚
â”‚  â€¢ æŒ‰ã€Œç”¢ç”Ÿæ†‘è­‰ã€                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚HTTPS (TLS, AES payload)
                â–¼
â”Œâ”€(2) Credential Service (FastAPI)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ æ”¶åˆ°åŠ å¯† payload â†’ æš«å­˜åˆ° tmp             â”‚
â”‚  â€¢ è§¸ç™¼ Celery/Job Runner â†’                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€(3) Playwright Workerâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ è§£å¯† â†’ åŸ·è¡Œ login_and_save()             â”‚
â”‚  â€¢ å–å¾— auth.json                           â”‚
â”‚  â€¢ åŠ å¯†å¾Œå­˜ S3 / DB â†’ å›å‚³ credential_id    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€(4) Client / ä»»å‹™ APIâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ ä¸‹çˆ¬èŸ²ä»»å‹™æ™‚åªé€ credential_id           â”‚
â”‚  â€¢ Worker ä¸‹è¼‰ä¸¦è§£å¯† auth.json â†’ æŠ“è²¼æ–‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

* **CredentialÂ Service** èˆ‡ **Playwright Worker** åˆ†é›¢ï¼Œå¯ç”¨ k8s job æˆ– ECSÂ taskã€‚
* æ•´æ¢éˆçš„æ˜æ–‡å¸³å¯†åªå­˜åœ¨ Worker RAMï¼Œ**ç£ç¢Ÿæ°¸ä¸è½åœ°**ã€‚
* è‹¥å®¢æˆ¶æ”¹å¯†ç¢¼â†’ å¤±æ•ˆï¼›å†è·‘ä¸€æ¬¡æµç¨‹ç”¢ç”Ÿæ–° credentialã€‚

---

### è¦ä¸è¦åšï¼Ÿ

| ç‹€æ³                     | å»ºè­°                               |
| ---------------------- | -------------------------------- |
| ä¼æ¥­å®¢æˆ¶ã€å¸³è™Ÿéå¸¸é‡è¦            | **æ‰‹å‹•ç™»å…¥**ï¼ˆFlowÂ B åŸç‰ˆï¼‰æˆ– Meta å®˜æ–¹ API |
| å€‹äºº sideâ€‘project / Demo | å¯ä»¥å…¨è‡ªå‹•ï¼Œå¤±æ•—äº†é‡è·‘                      |

---

#### ä¸€å¥è©±æ”¶å°¾

> **èƒ½è‡ªå‹•åšï¼Œä½†è¦æƒ³æ¸…æ¥šã€Œè³‡æ–™å®‰å…¨ã€èˆ‡ã€Œå¸³è™Ÿå­˜æ´»ã€äºŒé¸ä¸€è¦æ€éº¼å¹³è¡¡ã€‚**

éœ€è¦ç¯„ä¾‹ç¨‹å¼ã€VaultÂ æ•´åˆã€æˆ– proxyÂ é…ç½®å¯¦æˆ°ï¼Œå†å«æˆ‘å°±è¡Œï¼

#################

### 1â€¯|â€¯ã€Œauth.jsonâ€¯è¦æ”¾å“ªï¼Ÿã€ â”€â”€ å…©ç¨®æœ€å¸¸è¦‹åšæ³•

| åšæ³•             | é©åˆæƒ…å¢ƒ                                      | è©²æ€éº¼å¯«                                                                          |
| -------------- | ----------------------------------------- | ----------------------------------------------------------------------------- |
| **ç›¸å°è·¯å¾‘ï¼ˆå°ˆæ¡ˆå…§ï¼‰**  | ä¸€çµ„å¸³è™Ÿåªçµ¦é€™æ”¯çˆ¬èŸ²ç”¨ï¼›éƒ¨ç½²åœ¨å–®ä¸€å®¹å™¨ / VM                  | `python<br># ä»»ä¸€æª”æ¡ˆ<br>AUTH_FILE = Path("auth.json")         # ./auth.json<br>` |
| **çµ•å°è·¯å¾‘ï¼ˆé›†ä¸­ç®¡ç†ï¼‰** | ä¸€å°æ©Ÿå™¨è·‘å¤šå¸³è™Ÿã€å¤šå°ˆæ¡ˆï¼›æƒ³æŠŠæ†‘è­‰çµ±ä¸€æ”¾ `/opt/threads/auth/` | `python<br>AUTH_FILE = Path("/opt/threads/auth/natgeo.json")<br>`             |

> åªè¦ **`AUTH_FILE` æŒ‡åˆ°ä½ è¦çš„ä½ç½®**ï¼ŒPlaywright çš„ `storage_state(path=AUTH_FILE)` å’Œ `new_context(storage_state=AUTH_FILE)` å°±æœƒè‡ªå‹•è®€ / å¯«é‚£å€‹æª”æ¡ˆâ”€â”€ä¸å¿…å†åŠ  `--user-data-dir`ã€‚

---

### 2â€¯|â€¯å®Œæ•´æµç¨‹ï¼ˆä¸€æ¬¡ç™»å…¥ â†’ ä¹‹å¾Œç„¡ç—›çˆ¬ï¼‰

```mermaid
graph LR
A[save_auth.py<br>(ç¬¬ä¸€æ¬¡ç™»å…¥)] -->|ç”¢ç”Ÿ auth.json| B(auth.json)
B --> C[threads_fetch.py<br>(ä¹‹å¾Œæ¯æ¬¡æŠ“å–)]
C -->|å¦‚æœå¤±æ•ˆå°±<br>å†è·‘ä¸€æ¬¡ A| A
```

#### æ­¥é©Ÿç´°ç¯€

| æ­¥é©Ÿ              | æŒ‡ä»¤                                                                                                  | ç›®çš„                                                                                                                               |
| --------------- | --------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| **(1) ç™»å…¥ä¸¦ç”¢ç”Ÿæ†‘è­‰** | `python save_auth.py --out /opt/threads/auth/natgeo.json`<br>`# æˆ–ä¿®æ”¹æª”æ¡ˆè£¡çš„ AUTH_FILE`                  | æ‰‹å‹•è¼¸å…¥å¸³å¯† â†’ Playwright å¹«ä½ æŠŠ access token, cookiesâ€¦ å…¨å­˜é€² `auth.json`                                                                   |
| **(2) é–‹çˆ¬**      | `python threads_fetch.py --auth /opt/threads/auth/natgeo.json --max 100`<br>`# æˆ–ç›´æ¥åœ¨æª”æ¡ˆä¸­å¯«æ­» AUTH_FILE` | Playwright ä»¥ **å¸¶ç™»å…¥ç‹€æ…‹çš„ Context** é–‹ [https://www.threads.com/@natgeo](https://www.threads.com/@natgeo) â†’ ç›£è½ GraphQL â†’ æ»¾å‹• â†’ è§£æ â†’ å­˜æª” |
| **(3) æ†‘è­‰éæœŸ**    | æŠ“ä¸åˆ°è³‡æ–™ / æ”¶åˆ° 401 â†’ å›åˆ°æ­¥é©Ÿ (1) é‡ç™»                                                                        | Threads é€šå¸¸ 30ï½60â€¯å¤© Cookie æœƒå¤±æ•ˆï¼›é‡æ–°ç”¢ç”Ÿå³å¯                                                                                             |

> * **ä¸ç”¨å†å‹• userâ€‘dataâ€‘dir**ï¼šä½ çœŸæ­£è¦çš„åªæ˜¯ *storage state*ï¼Œ`auth.json` å·²ç¶“åŒ…å«æ‰€æœ‰ cookie & localStorageã€‚
> * `auth.json` å¯ä»¥éš¨ä¾¿å‘½åï¼Œæ”¾ä»»ä½•å­è³‡æ–™å¤¾ï¼Œåªè¦çˆ¬èŸ²æŒ‡å‘æ­£ç¢ºè·¯å¾‘å°±è¡Œã€‚

---

### 3â€¯|â€¯CLI æ——æ¨™ç¯„ä¾‹ï¼ˆå¯é¸ï¼‰

çµ¦å…©æ”¯è…³æœ¬å„åŠ ä¸€å€‹ `--auth` é¸é …ï¼Œå®¢æˆ¶å°±èƒ½ç”¨åƒæ•¸æ±ºå®šæª”æ¡ˆä½ç½®ï¼›ç¨‹å¼å…§éƒ¨ä»ä¿æœ‰é è¨­å€¼ã€‚

```python
# save_auth.py
import argparse, asyncio, pathlib
...
parser = argparse.ArgumentParser()
parser.add_argument("--out", default="auth.json", help="output auth.json path")
args = parser.parse_args()
AUTH_FILE = pathlib.Path(args.out)
...

# threads_fetch.py
parser = argparse.ArgumentParser()
parser.add_argument("--auth", default="auth.json", help="auth.json path")
parser.add_argument("--max",  type=int, default=100, help="max posts")
args = parser.parse_args()
AUTH_FILE = pathlib.Path(args.auth)
MAX_POSTS = args.max
```

---

### 4â€¯|â€¯å¦‚æœæƒ³ã€Œå®Œå…¨è‡ªå‹•ã€â”€â”€ å¸³å¯†ç›´ä¸Ÿè…³æœ¬

```python
async def auto_login(username, password, out_path="auth.json"):
    async with async_playwright() as p:
        ctx = await p.chromium.launch(headless=False)  # å»ºè­° headful é™é¢¨éšª
        page = await ctx.new_page()
        ...
        await ctx.storage_state(path=out_path)
```

* **å®‰å…¨**ï¼šå¸³å¯†å¿…é ˆåŠ å¯† & ç¢ºä¿å­˜å–æ¬Šé™ï¼Œå¦å‰‡å®¹æ˜“è¢«ç›œã€‚
* **é¢¨éšª**ï¼šè‡ªå‹•åŒ–ç™»å…¥æ¯”å„²å­˜â€¯cookie æ›´å®¹æ˜“è¢« Meta é¢¨æ§åµåˆ°ï¼ˆIPã€æŒ‡ç´‹ï¼‰ã€‚
* å¦‚æœåªæ˜¯è¦ã€Œè·‘ä¸€æ¬¡å†æ‰‹å‹•ã€ï¼Œæ¨è–¦é‚„æ˜¯ **æ‰‹å‹•ç™»å…¥ â†’ å­˜ auth.json**ï¼Œæœ€ç°¡å–®ä¹Ÿæœ€å®‰å…¨ã€‚

---

#### å°çµ

1. **æŠŠ `AUTH_FILE` æŒ‡åˆ°ä½ æƒ³è¦çš„è·¯å¾‘**ï¼ŒPlaywright å°±æœƒè®€å¯«é‚£è£¡ã€‚
2. ç¬¬ä¸€æ¬¡è·‘ `save_auth.py` æ‰‹å‹•ç™»å…¥ â†’ ç”¢å‡º `auth.json`ã€‚
3. ä»¥å¾Œçˆ¬å–åªè¦ `threads_fetch.py` æŒ‡å‘åŒä¸€æª”æ¡ˆã€‚
4. Cookie éæœŸå†å›åˆ°æ­¥é©Ÿâ€¯1ã€‚

ç…§é€™å€‹æ¨¡å¼ï¼Œå®¢æˆ¶åªè¦ã€Œç™»å…¥ä¸€æ¬¡ã€ä¸Ÿä¸€å€‹æª”ã€å°±èƒ½ä¸€ç›´æŠ“è³‡æ–™ï¼Œæ•´å€‹æµç¨‹æœ€ä¹¾æ·¨ä¹Ÿæœ€å®¹æ˜“ç¶­é‹ã€‚

