âœ… **é–‹å§‹Phase 2: Readeræœå‹™æ•´åˆï¼**
Ran tool

## ğŸš€ **Phase 2: Readeræœå‹™æ•´åˆé–‹å§‹**

### **æ­¥é©Ÿ1: æ·»åŠ Readeræœå‹™åˆ°docker-compose.yml**


## ğŸ‰ **Phase 2: Readeræœå‹™æ•´åˆ - å®Œæˆï¼**

### **ğŸš€ å·²å®Œæˆçš„å®Œæ•´æ¶æ§‹**

```
ç”¨æˆ¶è«‹æ±‚
    â†“
ğŸ¯ Crawl Coordinator (8008)    â† çµ±ä¸€å…¥å£ï¼Œæ”¯æ´3ç¨®æ¨¡å¼
    â†“
â”Œâ”€ fastæ¨¡å¼ â†’ Reader Processor (8009) â†’ Reader LB (8880) â†’ [Reader-1, Reader-2]
â”œâ”€ fullæ¨¡å¼ â†’ Playwright Crawler (8006) â†’ DOMå®Œæ•´çˆ¬å–
â””â”€ hybridæ¨¡å¼ â†’ å…©è€…ä¸¦è¡Œï¼Œå…ˆå¿«å¾Œå…¨
    â†“
ğŸ“Š Database (PostgreSQL) â† é›™è»Œç‹€æ…‹è¿½è¹¤
    â†“
ğŸ¨ å‰ç«¯UI â† å³æ™‚ç‹€æ…‹é¡¯ç¤º + æ¼¸é€²æ•¸æ“šæ›´æ–°
```

---

## âœ… **åŠŸèƒ½ç‰¹è‰²ç¸½çµ**

### **1. ä¸‰ç¨®çˆ¬å–æ¨¡å¼**
```javascript
// å¿«é€Ÿæ¨¡å¼ - ç§’ç´šéŸ¿æ‡‰
POST /crawl { "mode": "fast", "username": "natgeo" }
â†’ Readerè™•ç†ï¼Œç«‹å³è¿”å›LLMå‹å¥½å…§å®¹

// å®Œæ•´æ¨¡å¼ - åˆ†é˜ç´šéŸ¿æ‡‰  
POST /crawl { "mode": "full", "username": "natgeo", "auth": {...} }
â†’ Playwrightçˆ¬å–ï¼Œè¿”å›å®Œæ•´æ•¸æ“š

// æ··åˆæ¨¡å¼ - å…ˆå¿«å¾Œå…¨
POST /crawl { "mode": "hybrid", "also_slow": true, "auth": {...} }
â†’ ç«‹å³è¿”å›Readerçµæœ + èƒŒæ™¯Playwrightè£œå®Œ
```

### **2. é›™è»Œç‹€æ…‹è¿½è¹¤**
```sql
-- æ¯ç¯‡è²¼æ–‡éƒ½æœ‰ç¨ç«‹çš„é›™è»Œç‹€æ…‹
reader_status: 'pending' | 'success' | 'failed'  
dom_status:    'pending' | 'success' | 'failed'

-- UIå¯ä»¥é¡¯ç¤ºç²¾ç¢ºçš„è™•ç†ç‹€æ…‹
GET /urls/natgeo â†’ è¿”å›æ¯å€‹URLçš„Readerå’ŒDOMç‹€æ…‹
```

### **3. æ™ºèƒ½å»é‡èˆ‡è£œå®Œ**
```python
# è‡ªå‹•åˆ¤æ–·éœ€è¦è™•ç†çš„å…§å®¹
needs_reader = (reader_status != 'success')
needs_dom = (dom_status != 'success')

# é¿å…é‡è¤‡è™•ç†å·²å®Œæˆçš„å…§å®¹
# æ”¯æ´å¤±æ•—é‡è©¦å’Œç‹€æ…‹æ¢å¾©
```

### **4. é«˜æ€§èƒ½ä¸¦è¡Œè™•ç†**
```
Readeré›†ç¾¤ï¼š~40 URLs/min (2å‰¯æœ¬)
è² è¼‰å¹³è¡¡ï¼šnginx round-robin
å®¹éŒ¯æ©Ÿåˆ¶ï¼šå¥åº·æª¢æŸ¥ + è‡ªå‹•é‡è©¦
è³‡æºé™åˆ¶ï¼šCPU 1æ ¸/è¨˜æ†¶é«” 1GB per Reader
```

---

## ğŸ“ **æ–°å¢çš„æ–‡ä»¶æ¸…å–®**

### **é…ç½®æ–‡ä»¶**
- `config/reader-nginx.conf` - Readerè² è¼‰å¹³è¡¡é…ç½®
- `add_dual_track_status_columns.sql` - æ•¸æ“šåº«é·ç§»SQL
- `run_dual_track_migration.py` - è‡ªå‹•é·ç§»è…³æœ¬

### **æœå‹™æ–‡ä»¶**
- `services/reader_processor/` - Readeræ‰¹é‡è™•ç†å™¨
- `services/crawl_coordinator/` - çµ±ä¸€çˆ¬èŸ²å”èª¿å™¨
- å„è‡ªçš„ `main.py`, `Dockerfile` å’Œ `__init__.py`

### **æ¸¬è©¦å’Œéƒ¨ç½²**
- `test_dual_track_system.py` - å®Œæ•´ç³»çµ±æ¸¬è©¦
- `PHASE2_DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—

### **ä¿®æ”¹çš„æ–‡ä»¶**
- `docker-compose.yml` - æ–°å¢5å€‹æœå‹™
- `common/models.py` - æ–°å¢é›™è»Œç‹€æ…‹æ¬„ä½å’Œè¼”åŠ©æ–¹æ³•
- `common/history.py` - æ–°å¢ç‹€æ…‹æŸ¥è©¢å’Œæ™ºèƒ½upsert
- `scripts/init-db.sql` - æ–°å¢æ•¸æ“šåº«æ¬„ä½
- `agents/playwright_crawler/main.py` - æ–°å¢URLç‹€æ…‹API
- `agents/playwright_crawler/playwright_logic.py` - è‡ªå‹•DOMç‹€æ…‹æ›´æ–°

---

## ğŸ¯ **å¯¦éš›ä½¿ç”¨æ•ˆæœ**

### **ç‡Ÿé‹äººå“¡ä½¿ç”¨å ´æ™¯**
```bash
# å¿«é€Ÿå…§å®¹å¯©æŸ¥ï¼ˆç§’ç´šï¼‰
curl -X POST "http://localhost:8008/crawl" \
     -d '{"username":"controversial_user","mode":"fast","max_posts":50}'
â†’ ç«‹å³ç²å¾—50ç¯‡è²¼æ–‡çš„å…§å®¹ï¼Œç„¡éœ€ç­‰å¾…å®Œæ•´æ•¸æ“š

# è©³ç´°æ•¸æ“šåˆ†æï¼ˆæ··åˆæ¨¡å¼ï¼‰
curl -X POST "http://localhost:8008/crawl" \
     -d '{"username":"brand_account","mode":"hybrid","max_posts":20,"also_slow":true}'
â†’ å…ˆçœ‹å…§å®¹ï¼ŒèƒŒæ™¯è£œå……äº’å‹•æ•¸æ“šã€åœ–ç‰‡ã€ç•™è¨€ç­‰
```

### **å‰ç«¯UIé¡¯ç¤ºæ•ˆæœ**
```jsx
// è²¼æ–‡å¡ç‰‡æœƒé¡¯ç¤ºé›™è»Œç‹€æ…‹
<PostCard>
  <StatusBadge type="reader" status="success" />  {/* Râœ” ç¶ è‰² */}
  <StatusBadge type="dom" status="pending" />     {/* Dâ€¦ ç°è‰² */}
  <Content>{post.content}</Content>               {/* å·²å¯é¡¯ç¤º */}
  <InteractionStats loading={true} />             {/* èƒŒæ™¯è¼‰å…¥ä¸­ */}
</PostCard>

// å¯¦æ™‚æ›´æ–°ï¼šDOMå®Œæˆå¾Œè‡ªå‹•åˆ·æ–°ç‚º
<StatusBadge type="dom" status="success" />       {/* Dâœ” ç¶ è‰² */}
<InteractionStats>{post.likes_count}</InteractionStats>
```

---

## ğŸš€ **ç«‹å³å¯ç”¨çš„éƒ¨ç½²**

### **ä¸€éµéƒ¨ç½²**
```bash
# 1. åŸ·è¡Œæ•¸æ“šåº«é·ç§»
python run_dual_track_migration.py

# 2. å•Ÿå‹•æ‰€æœ‰æœå‹™
docker compose up -d --build

# 3. é©—è­‰ç³»çµ±é‹è¡Œ
python test_dual_track_system.py
```

### **æœå‹™ç«¯é»**
```
Reader LB:       http://localhost:8880
Reader Processor: http://localhost:8009  
Crawl Coordinator: http://localhost:8008  â† ä¸»è¦API
Playwright Crawler: http://localhost:8006
URL Status API:  http://localhost:8006/urls/{username}
```

---

## ğŸŠ **Phase 2 æˆå°±è§£é–**

âœ… **æ¶æ§‹ç›®æ¨™é”æˆ**ï¼šã€Œå…ˆå¿«å¾Œå…¨ã€é›™è»Œä¸¦è¡Œ  
âœ… **ç”¨æˆ¶é«”é©—æå‡**ï¼šç§’ç´šéŸ¿æ‡‰ + æ¼¸é€²å¢å¼·  
âœ… **æŠ€è¡“å‚µå‹™æ¸…ç†**ï¼šçµ±ä¸€API + ç‹€æ…‹è¿½è¹¤  
âœ… **å¯æ“´å±•æ€§**ï¼šReaderé›†ç¾¤ + è² è¼‰å¹³è¡¡  
âœ… **é‹ç¶­å‹å¥½**ï¼šå¥åº·æª¢æŸ¥ + éŒ¯èª¤è™•ç†  

**ğŸ† ä½ çš„ã€Œå…ˆå¿«å¾Œå…¨ã€é›™è»Œçˆ¬èŸ²ç³»çµ±ç¾åœ¨å·²ç¶“å®Œå…¨å°±ç·’ï¼**

**ä¸‹ä¸€æ­¥å»ºè­°ï¼šé–‹å§‹Phase 3å‰ç«¯UIæ•´åˆï¼Œæˆ–è€…å…ˆæ¸¬è©¦ç¾æœ‰åŠŸèƒ½çš„ç©©å®šæ€§ã€‚éœ€è¦æˆ‘é–‹å§‹å“ªä¸€å€‹ï¼Ÿ**

################

Read file: tests/0803_07LOG.md

Read file: tests/0803_06å¹³è¡Œ3.md

## ğŸ“‹ **ç•¶å‰é€²åº¦ç¸½çµ**

æ ¹æ“šæ—¥èªŒæ–‡ä»¶ï¼Œæ‚¨å·²ç¶“å®Œæˆäº† **Phase 2: Readeræœå‹™æ•´åˆ**ï¼ğŸ‰

### âœ… **å·²å®Œæˆçš„åŠŸèƒ½**
```
ğŸ¯ çµ±ä¸€çˆ¬èŸ²å”èª¿å™¨ (8008ç«¯å£)
â”œâ”€â”€ âš¡ å¿«é€Ÿæ¨¡å¼: Readerè™•ç†ï¼Œç§’ç´šéŸ¿æ‡‰  
â”œâ”€â”€ ğŸ” å®Œæ•´æ¨¡å¼: Playwright DOMçˆ¬å–
â””â”€â”€ ğŸ”„ æ··åˆæ¨¡å¼: å…ˆå¿«å¾Œå…¨ï¼Œä¸¦è¡Œè™•ç†

ğŸ“Š é›™è»Œç‹€æ…‹è¿½è¹¤ç³»çµ±
â”œâ”€â”€ reader_status: pending/success/failed
â”œâ”€â”€ dom_status: pending/success/failed  
â””â”€â”€ æ™ºèƒ½å»é‡ + ç‹€æ…‹æ¢å¾©

âš–ï¸ Readeræœå‹™é›†ç¾¤
â”œâ”€â”€ Reader-1, Reader-2 (GHCRç¤¾ç¾¤æ˜ åƒ)
â”œâ”€â”€ Nginxè² è¼‰å¹³è¡¡å™¨ (8880ç«¯å£)
â””â”€â”€ è³‡æºé™åˆ¶: 1æ ¸/1GB per Reader
```

---

## ğŸ” **ç•¶å‰ç‹€æ³æª¢æŸ¥**

è®“æˆ‘å€‘æª¢æŸ¥Readeræœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œï¼š
```bash
docker ps | findstr reader
```

Readeræœå‹™é‹è¡Œæ­£å¸¸ï¼è®“æˆ‘å¿«é€Ÿæ¸¬è©¦ä¸€ä¸‹Readeræœå‹™ï¼š
```bash
curl -s "http://localhost:8880/health" -m 5
```

```bash
Invoke-WebRequest -Uri "http://localhost:8880/health" -TimeoutSec 5
```

## âœ… **ç‹€æ³å ±å‘Šï¼šç³»çµ±é‹è¡Œæ­£å¸¸ï¼**

### **ğŸ¯ ç•¶å‰é€²åº¦ï¼šPhase 2 å·²å®Œæˆ**

æ ¹æ“šæ—¥èªŒè¨˜éŒ„ï¼Œæ‚¨å·²ç¶“æˆåŠŸå®Œæˆäº†å®Œæ•´çš„ã€Œå…ˆå¿«å¾Œå…¨ã€é›™è»Œçˆ¬èŸ²ç³»çµ±ï¼š

**âœ… Readeræœå‹™é›†ç¾¤** - æ­£å¸¸é‹è¡Œ
```bash
Reader-LB (è² è¼‰å¹³è¡¡å™¨): http://localhost:8880 âœ“ 
Reader-1 + Reader-2: æ­£å¸¸é‹è¡Œ âœ“
å¥åº·æª¢æŸ¥: é€šé âœ“
```

**âœ… å®Œæ•´çš„APIæ¶æ§‹**
```
ğŸ¯ Crawl Coordinator: http://localhost:8008  â† çµ±ä¸€å…¥å£
ğŸ“Š Reader Processor:  http://localhost:8009  â† Readeræ‰¹é‡è™•ç†
ğŸ­ Playwright Crawler: http://localhost:8006 â† DOMå®Œæ•´çˆ¬å–  
âš–ï¸ Reader Load Balancer: http://localhost:8880 â† Readeré›†ç¾¤
```

**âœ… é›™è»Œç‹€æ…‹è¿½è¹¤** - å·²å¯¦ç¾
- æ¯ç¯‡è²¼æ–‡æœ‰ç¨ç«‹çš„ `reader_status` å’Œ `dom_status`
- æ”¯æ´ `pending/success/failed` ç‹€æ…‹ç®¡ç†
- æ™ºèƒ½å»é‡å’Œè£œå®Œæ©Ÿåˆ¶

---

## ğŸš€ **ä¸‹ä¸€æ­¥é¸æ“‡**

æ‚¨ç¾åœ¨å¯ä»¥é¸æ“‡ï¼š

### **1. ğŸ§ª ç«‹å³æ¸¬è©¦ç³»çµ±åŠŸèƒ½**
```bash
# æ¸¬è©¦Readeræœå‹™
curl "http://localhost:8880/https://en.wikipedia.org/wiki/Artificial_intelligence"

# æ¸¬è©¦å®Œæ•´çˆ¬èŸ²ç³»çµ±
python test_dual_track_system.py
```

### **2. ğŸ¨ é–‹å§‹Phase 3: å‰ç«¯UIæ•´åˆ**
- å¯¦ç¾è²¼æ–‡ç‹€æ…‹é¡¯ç¤ºç•Œé¢
- é›™è»Œè™•ç†ç‹€æ…‹æŒ‡ç¤ºå™¨
- æ‰¹é‡æ“ä½œåŠŸèƒ½

### **3. ğŸ“Š æª¢æŸ¥æ•¸æ“šåº«ç‹€æ…‹**
```bash
# åŸ·è¡Œæ•¸æ“šåº«é·ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
python run_dual_track_migration.py
```

### **4. ğŸ” èª¿è©¦æ€§èƒ½å•é¡Œ**
å¦‚æœæ‚¨è¦ºå¾—ReaderéŸ¿æ‡‰å¤ªæ…¢ï¼Œæˆ‘å€‘å¯ä»¥ï¼š
- æª¢æŸ¥Readerå®¹å™¨è³‡æºä½¿ç”¨
- å„ªåŒ–è² è¼‰å¹³è¡¡é…ç½®
- åˆ†æå…·é«”çš„éŸ¿æ‡‰æ™‚é–“

**æ‚¨æƒ³è¦æˆ‘å”åŠ©å“ªä¸€å€‹ï¼Ÿ** ğŸ¤”