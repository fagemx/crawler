ğŸ“‹ éœ€æ±‚åˆ†æ
æ ¸å¿ƒåŠŸèƒ½
Clarification Agent - åˆ†æç”¨æˆ¶è¼¸å…¥ï¼Œç”Ÿæˆ 3-5 é¡Œå‹•æ…‹å•å·
Form API - è™•ç†è¡¨å–®å±•ç¤ºå’Œç­”æ¡ˆæ”¶é›†
æµç¨‹æ•´åˆ - å°‡æ¾„æ¸…çµæœæ•´åˆåˆ°ç¾æœ‰çš„å…§å®¹ç”Ÿæˆæµç¨‹
JSON Schema - æ”¯æ´å…©ç¨®é¢¨æ ¼ï¼ˆnarrative/line_break_listï¼‰+ custom_user_requirements
æŠ€è¡“åˆ¤æ–·é‚è¼¯
å•ç­”éšæ®µ: æª¢æ¸¬ç”¨æˆ¶è¼¸å…¥ç¼ºå£ â†’ ç”Ÿæˆçµæ§‹åŒ–å•å· JSON
è¡¨å–®éšæ®µ: æ”¶é›†ç”¨æˆ¶é¸æ“‡ + è‡ªè¨‚è¼¸å…¥
æ•´åˆéšæ®µ: åˆä½µç‚º custom_user_requirements
ç”Ÿæˆéšæ®µ: å¥—ç”¨æ¨¡æ¿ + éœ€æ±‚ç”Ÿæˆæœ€çµ‚å…§å®¹
ğŸ¯ å¯¦è¸æ­¥é©Ÿè¦åŠƒ
Phase 1: åŸºç¤æ¶æ§‹æ“´å±•
æ–°å¢ Clarification Agent (port 8004)

å»ºç«‹ agents/clarification/ ç›®éŒ„çµæ§‹
å¯¦ä½œ LLM å•å·ç”Ÿæˆé‚è¼¯
æ•´åˆ NATS è¨Šæ¯æµ
æ–°å¢ Form API (port 8010)

å»ºç«‹ services/form_api/ ç›®éŒ„
å¯¦ä½œ REST API ç«¯é»
è™•ç†è¡¨å–®ç‹€æ…‹ç®¡ç†
æ“´å±• Docker Compose

æ·»åŠ å…©å€‹æ–°æœå‹™å®šç¾©
é…ç½®ç¶²è·¯å’Œä¾è³´é—œä¿‚
Phase 2: è³‡æ–™åº« Schema æ“´å±•
Sessions è¡¨

CREATE TABLE sessions (
  session_id UUID PRIMARY KEY,
  raw_input TEXT,
  clarification_questions JSONB,
  user_answers JSONB,
  custom_requirements JSONB,
  final_post TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
Post Templates è¡¨

CREATE TABLE post_templates (
  template_id SERIAL PRIMARY KEY,
  style VARCHAR(50), -- 'narrative' or 'line_break_list'
  template_data JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
Phase 3: NATS è¨Šæ¯æµè¨­è¨ˆ
user.request â†’ clarification.request â†’ clarification.result 
â†’ form.display â†’ form.answer â†’ requirement.synthesis 
â†’ content.generate â†’ content.result
Phase 4: æ ¸å¿ƒé‚è¼¯å¯¦ä½œ
Orchestrator ä¿®æ”¹ - æ·»åŠ æ¾„æ¸…æµç¨‹è™•ç†
Content Writer æ“´å±• - æ”¯æ´ custom_user_requirements
æ¨¡æ¿ç³»çµ± - å¯¦ä½œå…©ç¨®é¢¨æ ¼çš„ JSON æ¨¡æ¿
â“ ç–‘å•å’Œéœ€è¦æ¾„æ¸…çš„åœ°æ–¹
1. LLM API é…ç½®
ä½ åå¥½ä½¿ç”¨å“ªå€‹ LLM æä¾›å•†ï¼Ÿ(OpenAI/Claude/æœ¬åœ°æ¨¡å‹)
API Key å¦‚ä½•ç®¡ç†ï¼Ÿæ˜¯å¦å·²åœ¨ .env ä¸­é…ç½®ï¼Ÿ
2. è¡¨å–® UI ç­–ç•¥
æš«æ™‚æ²’æœ‰å‰ç«¯çš„æƒ…æ³ä¸‹ï¼Œæ˜¯å¦ç”¨ CLI/cURL æ¸¬è©¦å°±è¶³å¤ ï¼Ÿ
æœªä¾†å‰ç«¯æ˜¯å¦æœƒç”¨ React/Vueï¼Œé‚„æ˜¯ç¹¼çºŒç”¨ Streamlitï¼Ÿ
3. è³‡æ–™æŒä¹…åŒ–ç­–ç•¥
Session ç‹€æ…‹æ˜¯å¦éœ€è¦æŒä¹…åŒ–åˆ° PostgreSQLï¼Ÿ
Redis ä¸­çš„è‡¨æ™‚ç‹€æ…‹ä¿ç•™å¤šä¹…ï¼Ÿ
4. ç¾æœ‰ Content Writer Agent æ•´åˆ
ç›®å‰çš„ Content Writer Agent æ˜¯å¦å·²ç¶“å­˜åœ¨ï¼Ÿ
å¦‚æœä¸å­˜åœ¨ï¼Œæ˜¯å¦éœ€è¦å¾é ­å»ºç«‹ï¼Ÿ
5. æ¨¡æ¿ç®¡ç†
JSON æ¨¡æ¿æ˜¯å¦è¦å­˜åœ¨è³‡æ–™åº«ä¸­ï¼Œé‚„æ˜¯ä½œç‚ºé…ç½®æª”æ¡ˆï¼Ÿ
æ˜¯å¦éœ€è¦æ”¯æ´å‹•æ…‹æ·»åŠ æ–°çš„è²¼æ–‡é¢¨æ ¼ï¼Ÿ
6. éŒ¯èª¤è™•ç†å’Œå›é€€æ©Ÿåˆ¶
å¦‚æœ LLM å›æ‡‰æ ¼å¼ä¸æ­£ç¢ºæ€éº¼è™•ç†ï¼Ÿ
ç”¨æˆ¶ä¸å›ç­”å•å·çš„æƒ…æ³ä¸‹ï¼Œæ˜¯å¦æœ‰é è¨­è¡Œç‚ºï¼Ÿ
7. ç›£æ§å’Œæ—¥èªŒ
æ˜¯å¦éœ€è¦åœ¨ç¾æœ‰çš„ Jaeger/Prometheus ä¸­æ·»åŠ æ–°çš„è¿½è¹¤æŒ‡æ¨™ï¼Ÿ
æ¾„æ¸…æµç¨‹çš„æˆåŠŸç‡å¦‚ä½•ç›£æ§ï¼Ÿ
ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€ç¢ºèª
1. Agent è¨»å†Šæ©Ÿåˆ¶
æ–°çš„ Clarification Agent æ˜¯å¦éœ€è¦åœ¨ MCP Server ä¸­è¨»å†Šï¼Ÿé‚„æ˜¯ä½œç‚ºå…§éƒ¨æœå‹™ï¼Ÿ

2. NATS Topic å‘½åè¦ç¯„
å»ºè­°çš„ topic å‘½åæ˜¯å¦ç¬¦åˆç¾æœ‰çš„è¦ç¯„ï¼Ÿéœ€è¦èª¿æ•´å—ï¼Ÿ

3. å®‰å…¨è€ƒé‡
LLM Prompt Injection é˜²è­·
ç”¨æˆ¶è¼¸å…¥é©—è­‰å’Œæ¸…ç†
API ç«¯é»çš„èªè­‰æ©Ÿåˆ¶
è«‹ç¢ºèªé€™äº›ç–‘å•ï¼Œæˆ‘å°±å¯ä»¥é–‹å§‹å…·é«”å¯¦ä½œäº†ï¼

######################################################

 ä¿®å¾©é€²åº¦ç¸½çµå ±å‘Š
âœ… å·²å®Œæˆçš„ä¿®å¾©æ­¥é©Ÿ (1-5)
æ­¥é©Ÿ 1: Redis å®¢æˆ¶ç«¯ä¿®å¾© âœ… å®Œæˆ
pyproject.toml: æ›´æ–°ç‚º redis[asyncio]>=6.2.0
common/redis_client.py: å¾ aioredis å‡ç´šåˆ° redis.asyncio
æ‰€æœ‰ Dockerfile: çµ±ä¸€ä½¿ç”¨ pyproject.toml ä¾è³´ç®¡ç†
æ­¥é©Ÿ 2: æœå‹™é–“ URL ä¿®æ­£ âœ… å®Œæˆ
.env: æ·»åŠ æœå‹™é–“é€šä¿¡ URL ç’°å¢ƒè®Šæ•¸
ORCHESTRATOR_URL=http://orchestrator-agent:8000
CLARIFICATION_URL=http://clarification-agent:8004
CONTENT_WRITER_URL=http://content-writer-agent:8003
FORM_API_URL=http://form-api:8010
settings.py: æ·»åŠ  ServiceURLSettings é…ç½®é¡
orchestrator/main.py: ä¿®æ­£ 3 å€‹ç¡¬ç·¨ç¢¼ localhost URL
æ­¥é©Ÿ 3: ç’°å¢ƒè®Šæ•¸è£œå…¨ âœ… å®Œæˆ
docker-compose.yml: ç‚ºæ‰€æœ‰ç›¸é—œæœå‹™æ·»åŠ ç’°å¢ƒè®Šæ•¸
çµ±ä¸€é…ç½®: ç¢ºä¿ Docker å®¹å™¨é–“ä½¿ç”¨æœå‹™åé€šä¿¡
æ­¥é©Ÿ 4: Form-API è‡ªå‹•è§¸ç™¼ âœ… å®Œæˆ
services/form_api/main.py: ä¿®æ”¹ submit_answers ç«¯é»
è‡ªå‹•åŒ–æµç¨‹: æäº¤ç­”æ¡ˆå¾Œè‡ªå‹•èª¿ç”¨ Orchestrator /answers ç«¯é»
éŒ¯èª¤è™•ç†: æ·»åŠ æœå‹™é–“èª¿ç”¨çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
æ­¥é©Ÿ 5: ä¾è³´ç®¡ç†çµ±ä¸€ âœ… å®Œæˆ
çµ±ä¸€ä½¿ç”¨ pyproject.toml: æ‰€æœ‰ Dockerfile æ”¹ç”¨ pip install -e ".[messaging,ai]"
ç‰ˆæœ¬ä¸€è‡´æ€§: Docker å’Œæœ¬åœ°é–‹ç™¼ä½¿ç”¨ç›¸åŒä¾è³´ç‰ˆæœ¬
æ¨¡çµ„åŒ–ä¾è³´: æ”¯æ´æŒ‰éœ€å®‰è£ä¾è³´çµ„åˆ
ğŸ”§ æ ¸å¿ƒæŠ€è¡“æ”¹é€²
1. ä¾è³´ç®¡ç†ç¾ä»£åŒ–
å¾: ç¡¬ç·¨ç¢¼ pip install + aioredis
åˆ°: pyproject.toml + redis[asyncio]>=6.2.0
2. æœå‹™é€šä¿¡æ¨™æº–åŒ–
å¾: ç¡¬ç·¨ç¢¼ localhost URL
åˆ°: Docker æœå‹™å + ç’°å¢ƒè®Šæ•¸é…ç½®
3. æµç¨‹è‡ªå‹•åŒ–
å¾: æ‰‹å‹•èª¿ç”¨å„å€‹ç«¯é»
åˆ°: Form API è‡ªå‹•è§¸ç™¼å®Œæ•´æµç¨‹
ğŸ“‹ ç•¶å‰ç³»çµ±ç‹€æ…‹
âœ… å·²å°±ç·’çš„æœå‹™
Orchestrator Agent (8000) - ç¸½å”èª¿å™¨
Clarification Agent (8004) - æ™ºèƒ½å•é¡Œç”Ÿæˆ
Content Writer Agent (8003) - å…§å®¹ç”Ÿæˆ
Form API (8010) - è¡¨å–®è™•ç†
ğŸ”„ å®Œæ•´æµç¨‹
ç”¨æˆ¶è¼¸å…¥ â†’ Orchestrator â†’ Clarification Agent â†’ Form API 
â†’ ç”¨æˆ¶å¡«å¯« â†’ Form API è‡ªå‹•è§¸ç™¼ â†’ Orchestrator â†’ Content Writer â†’ æœ€çµ‚è²¼æ–‡
ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ
ç«‹å³å¯åŸ·è¡Œ
# 1. é‡å»ºå®¹å™¨
docker-compose build orchestrator-agent form-api clarification-agent content-writer-agent

# 2. å•Ÿå‹•æœå‹™
docker-compose up -d --force-recreate orchestrator-agent form-api clarification-agent content-writer-agent

# 3. æ¸¬è©¦å®Œæ•´æµç¨‹
python test_intelligent_clarification.py
æ¸¬è©¦æ¡ˆä¾‹
è¼¸å…¥: "è«‹å¹«æˆ‘å‰µå»ºè²¼æ–‡ï¼Œç°¡å–®ä¸€é»ï¼Œç„¶å¾ŒåŒ–å¦æ–°å“æœˆåº•å‰æ‰“8æŠ˜"
é æœŸ: ç”Ÿæˆå•å· â†’ ç”¨æˆ¶å¡«å¯« â†’ è‡ªå‹•ç”Ÿæˆè²¼æ–‡
ğŸ“ äº¤æ¥é‡é»
é—œéµæª”æ¡ˆ
agents/orchestrator/main.py - æ ¸å¿ƒå”èª¿é‚è¼¯
services/form_api/main.py - è‡ªå‹•è§¸ç™¼é‚è¼¯
common/redis_client.py - å‡ç´šå¾Œçš„ Redis å®¢æˆ¶ç«¯
pyproject.toml - çµ±ä¸€ä¾è³´ç®¡ç†
ç’°å¢ƒé…ç½®
.env - æœå‹™é–“é€šä¿¡ URL
docker-compose.yml - å®¹å™¨ç’°å¢ƒè®Šæ•¸
æ¸¬è©¦è…³æœ¬
test_intelligent_clarification.py - å®Œæ•´æµç¨‹æ¸¬è©¦
test_mcp_complete.py - ç³»çµ±å¥åº·æª¢æŸ¥
ğŸ¯ ç³»çµ±å·²æº–å‚™å°±ç·’
æ‰€æœ‰æ ¸å¿ƒä¿®å¾©å·²å®Œæˆï¼Œç³»çµ±ç¾åœ¨å…·å‚™ï¼š

âœ… ç¾ä»£åŒ–çš„ä¾è³´ç®¡ç†
âœ… æ¨™æº–åŒ–çš„æœå‹™é€šä¿¡
âœ… è‡ªå‹•åŒ–çš„è™•ç†æµç¨‹
âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†
å¯ä»¥é–‹å§‹æ¸¬è©¦ã€Œä¸‰å±¤ LLM â†’ è¡¨å–®æ¾„æ¸… â†’ å…§å®¹ç”Ÿæˆã€å®Œæ•´æµç¨‹ï¼

#########

åœ¨ Docker ç’°å¢ƒä¸­ï¼Œæœå‹™é–“é€šä¿¡æ‡‰è©²ä½¿ç”¨å®¹å™¨åç¨±è€Œä¸æ˜¯ localhostã€‚è®“æˆ‘æª¢æŸ¥ docker-compose.yml ä¾†ç¢ºèªæœå‹™åç¨±ï¼š

Read file(s)

docker-compose.yml 1 - 51
Read file(s)

docker-compose.yml 50 - 151
Read file(s)

docker-compose.yml 150 - 251
ç¾åœ¨æˆ‘æ˜ç™½å•é¡Œäº†ï¼åœ¨ Docker ç’°å¢ƒä¸­ï¼ŒOrchestrator æ‡‰è©²ä½¿ç”¨å®¹å™¨åç¨±ä¾†èª¿ç”¨å…¶ä»–æœå‹™ï¼Œä½† settings.py ä¸­çš„é è¨­ URL ä»ç„¶æ˜¯ localhostã€‚æˆ‘çœ‹åˆ° docker-compose.yml ä¸­å·²ç¶“è¨­ç½®äº†æ­£ç¢ºçš„ç’°å¢ƒè®Šæ•¸ï¼Œä½†è®“æˆ‘æª¢æŸ¥ .env æ–‡ä»¶ä¾†ç¢ºèªï¼š

Read file(s)

.env
å¾ˆå¥½ï¼æˆ‘çœ‹åˆ° .env æ–‡ä»¶ä¸­å·²ç¶“æ­£ç¢ºé…ç½®äº†æœå‹™é–“é€šä¿¡çš„ URLï¼š

ORCHESTRATOR_URL=http://orchestrator-agent:8000
CLARIFICATION_URL=http://clarification-agent:8004
CONTENT_WRITER_URL=http://content-writer-agent:8003
FORM_API_URL=http://form-api:8010