### å…ˆå›ç­” ã€Œæœƒä¸æœƒå¤ªç¬¨é‡ï¼Ÿã€

| ç–‘æ…®                  | å¯¦éš›æƒ…æ³                                                                                                 | èª¿æ•´ç­–ç•¥                                                                                                                                 |
| ------------------- | ---------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| **1 å®¹å™¨å¤šã€åŸ è™Ÿå¤šâ†’æµªè²»è³‡æºï¼Ÿ** | Docker Container å…±ç”¨åŒä¸€å€‹ Linux Kernelï¼›åªå¤šå‡º *PID/ns/ç¶²å¡* ç­‰è¼•é‡éš”é›¢ã€‚<br>CPU / RAM çœŸæ­£ä½¿ç”¨é‡ç”± **ç¨‹å¼** æ±ºå®šï¼Œè€Œä¸æ˜¯åŸ è™Ÿæˆ–å®¹å™¨å€‹æ•¸ã€‚ | - ç‚ºæ¯å€‹æœå‹™è¨­å®š `resources.limits`ï¼ˆCompose çš„ `deploy.resources` æˆ– k8s requests/limitsï¼‰ã€‚<br>- å°è…³è‰²å¯ç”¨ **Slim Base Image**ï¼ˆdistrolessã€alpineï¼‰ã€‚ |
| **2 åŸ è™Ÿé›œäº‚â†’ä¸å¥½ç®¡ç†ï¼Ÿ**    | åœ¨ Docker bridge æˆ– k8s ClusterIP è£¡ï¼ŒåŸ è™Ÿåªè¦å½¼æ­¤ä¸è¡çªå³å¯ï¼›å¤–éƒ¨å…¶å¯¦çœ‹ä¸åˆ°ã€‚                                               | - åªæŠŠ **Orchestrator API + Form API** æš´éœ²åˆ°å®¿ä¸»ï¼Œå…¶ä»–ç”¨ *internal port* å³å¯ï¼ˆç§»é™¤ `ports:`ï¼‰ã€‚<br>- æ”¾ä¸€å€‹åå‘ä»£ç†ï¼ˆTraefik/NGINX/Ingressï¼‰å°å¤–é–‹å–®ä¸€ 443 åŸ ã€‚      |
| **3 æœå‹™è¶ŠåŠ è¶Šå¤šâ†’å¸ƒç½²è¤‡é›œï¼Ÿ**  | Compose é©åˆæœ¬æ©Ÿé–‹ç™¼ï¼›ä¸Šç·šæ™‚æ”¹ç”¨ **Kubernetesã€Nomadã€ECS Fargate** ç­‰å¹³å°ï¼Œæ¯å€‹ Agent è®Šæˆ - Deployment + Serviceã€‚        | - ç”¨ **Helm Chart æˆ– Kustomize** æ‰“åŒ…ï¼Œåƒæ•¸åŒ–åŸ è™Ÿ/å‰¯æœ¬æ•¸ã€‚<br>- æˆ–è€…ä¹¾è„†æŠŠã€ŒClarifier + Writerã€åˆä½µæˆåŒä¸€å€‹ FastAPI Appï¼Œç¯€çœæœå‹™æ•¸ã€‚                                 |

---

### å¦‚ä½•éƒ¨ç½²æ‰èƒ½ã€Œä¸ç¬¨é‡ã€

1. **é–‹ç™¼ç’°å¢ƒï¼ˆæœ¬æ©Ÿ / å–®å°é›²ä¸»æ©Ÿï¼‰**

   * ä¿ç•™ `docker-compose.yml`ï¼Œä½†åƒ… `orchestrator-agent`, `form-api`, `postgres`, `redis`, `nats` æš´éœ²åŸ è™Ÿã€‚
   * å…¶é¤˜ `content-writer-agent`â€†ç­‰ *ä¸å°å¤–*ï¼š

     ```yaml
     content-writer-agent:
       expose: ["8003"]   # Docker ç¶²è·¯å…§å¯è¨ªå•ï¼Œå®¿ä¸»ä¸æ˜ å°„
     ```

2. **æ¸¬è©¦/é å‚™ç’°å¢ƒ**

   * ä»ç”¨ Composeï¼Œä½†åœ¨ `.env` è£¡é–‹å•Ÿ **PROFILE=minimal**ï¼š

     ```bash
     docker compose --profile minimal up -d
     ```
   * minimal åªè·‘æ ¸å¿ƒ Agentï¼ŒRAG Crawlerã€Vision æš«ä¸å•Ÿå‹•ã€‚

3. **æ­£å¼ç’°å¢ƒ â€“ å…©æ¢å¸¸è¦‹è·¯å¾‘**

   | è·¯å¾‘                                       | é©ç”¨         | å¯¦ä½œæ‘˜è¦                                                                                                                                                                                                 |
   | ---------------------------------------- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **A. å–®æ©Ÿå®¹å™¨ç·¨æ’ (Docker Compose + systemd)** | å°æµé‡ â€¢ æˆæœ¬æ•æ„Ÿ | 1. æŠŠæ‰€æœ‰å¤–éƒ¨æµé‡æŒ‡å‘ **NGINX â†’ Orchestrator API**ã€‚<br>2. `docker compose up -d` å³å®Œæˆéƒ¨ç½²ã€‚                                                                                                                       |
   | **B. Kubernetes (k3s / EKS / GKE)**      | é æœŸå¤šå‰¯æœ¬ã€å½ˆæ€§æ“´ç¸® | 1. `orchestrator-agent`, `content-writer-agent`, `clarification-agent` â†’ **Deployment**ã€‚<br>2. `Service` å‹åˆ¥ï¼šClusterIPï¼›å”¯æœ‰ `ingress-gateway` å°å¤–ã€‚<br>3. ç”¨ **HPA** è®“ `content-writer-agent` ä¾ä½‡åˆ—é•·åº¦è‡ªå‹•æ°´å¹³æ“´ç¸®ã€‚ |

---

### æ¸›å°‘ã€ŒåŸ è™Ÿ/å®¹å™¨ã€çš„å…©å€‹å¯é¸å„ªåŒ–

| åšæ³•                                                              | å„ªé»            | æ³¨æ„                               |
| --------------------------------------------------------------- | ------------- | -------------------------------- |
| **åˆä½µç¨‹å¼é‚è¼¯**<br>ï¼ˆClarifier + Content-Writer â†’ ä¸€å€‹ FastAPI Appï¼‰     | æœå‹™å°‘ã€å•Ÿå‹•å¿«ã€ç«¯å£æ›´ä¹¾æ·¨ | è‹¥æ—¥å¾Œå¸Œæœ›å–®ç¨æ“´å……å¯«æ‰‹ä½† Clarifier ä¸è®Šï¼Œå°±å¤±å»éˆæ´»åº¦ |
| **Sidecar / Thread æ¨¡å¼**<br>ï¼ˆåœ¨ Orchestrator å…§å•Ÿå‹•ã€Œå­åŸ·è¡Œç·’ã€è™•ç† Clarifyï¼‰ | æ•´é«”æ›´åƒå–®é«”ï¼Œéƒ¨ç½²æœ€ç°¡å–®  | å¤±å»èªè¨€/ç‰ˆæœ¬ç¨ç«‹æ€§ï¼Œä¹Ÿé›£ä»¥å–®ç¨æ°´å¹³æ“´              |

---

### çµ¦ä½ ä¸€æ®µ **Kubernetes Deployment ç¯„ä¾‹**ï¼ˆä¾›åƒè€ƒï¼‰

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: content-writer
spec:
  replicas: 2
  selector:
    matchLabels: { app: content-writer }
  template:
    metadata:
      labels: { app: content-writer }
    spec:
      containers:
      - name: writer
        image: registry.io/social-media-writer:latest
        env:
        - name: NATS_URL
          value: nats://nats:4222
        resources:
          requests: { cpu: "100m", memory: "256Mi" }
          limits:   { cpu: "500m", memory: "512Mi" }
---
apiVersion: v1
kind: Service
metadata:
  name: content-writer
spec:
  clusterIP: None          # åªåš Headlessï¼Œèµ° NATSï¼Œä¸ç”¨æš´éœ²ç«¯å£
  selector:
    app: content-writer
```

---

### å°çµ

1. **å®¹å™¨æ•¸é‡å¤š â‰  ç¬¨é‡**ï¼›åªè¦è¨­å®šå¥½è³‡æºä¸Šé™ï¼Œå°±åƒå¾ˆå¤šã€Œå°ç¨‹å¼ã€å…±ç”¨ä¸€å°æ©Ÿå™¨ã€‚
2. **å°å¤–åªç•™ 1â€“2 å€‹å…¥å£**ï¼šå…¶é¤˜æœå‹™èµ° Docker / k8s å…§ç¶²ï¼Œä¸å¿…æ˜ å°„åŸ è™Ÿã€‚
3. æƒ³å†ç²¾ç°¡ â†’ åˆä½µ Clarifier èˆ‡ Writerï¼›æˆ–ç­‰è¦ä¸Šç·šå†æ‹†ï¼ˆ**å…ˆ monolithï¼Œå¾Œå¾®æœ** çš„ç­–ç•¥ä¹Ÿå¯è¡Œï¼‰ã€‚
4. éƒ¨ç½²ï¼š

   * å°è¦æ¨¡ â†’ ç›´æ¥ `docker-compose up -d`ã€‚
   * è¦å½ˆæ€§æ“´ â†’ k3s / EKSï¼Œä¸Šé¢ç¤ºç¯„çš„ YAML ä¸€éµå¥—ç”¨å³å¯ã€‚

åªè¦æŒæ¡ã€Œ**æš´éœ²æœ€å°‘åŸ è™Ÿ** + **é™åˆ¶ CPU/RAM** + **æŒ‰éœ€æ‹†åˆæœå‹™**ã€ä¸‰åŸå‰‡ï¼Œä½ çš„æ¶æ§‹å¯ä»¥ä¸€ç›´é•·å¤§ï¼Œä½†é‹è¡Œä»ç„¶è¼•å·§ã€‚ç¥ä½ éƒ¨ç½²é †åˆ©ï¼

####
### å…ˆè¬›çµè«–

**å¦‚æœä½ çš„æœå‹™ï¼š**

1. åªæœ‰ 1 \~ 3 å°æ©Ÿå™¨å¯ç”¨
2. æ—¥æµé‡ < æ•¸è¬è«‹æ±‚ã€å¯æ¥å—æ‰‹å‹•æ»¾å‹•æ›´æ–°
3. åœ˜éšŠäººåŠ›æœ‰é™ã€æ²’å°ˆè· SRE

ğŸ‘‰ **å®Œå…¨å¯ä»¥ç¹¼çºŒç”¨ `docker-compose + systemd` æˆ– Docker Swarmï¼Œæ ¹æœ¬ä¸å¿…ä¸Š Kubernetesã€‚**

---

## ä»€éº¼æ™‚å€™ *ä¸ç”¨* K8sï¼Ÿ

| åˆ¤æ–·é»      | å…¸å‹å°å°ˆæ¡ˆç¾æ³          | é¸æ“‡                             |
| -------- | ---------------- | ------------------------------ |
| **ç¯€é»æ•¸**  | 1 å°é›²ä¸»æ©Ÿ / ä¸€å°å¯¦é«”ä¼ºæœå™¨ | ç›´æ¥ `docker-compose up -d`      |
| **æµé‡æ¨¡å¼** | å³°å€¼åœ¨å–®ç¯€é»å¯æ‰¿å—        | ç”¨ Compose æ­é… `restart: always` |
| **éƒ¨ç½²é »ç‡** | ä¸€é€± < 2 æ¬¡         | ssh + `git pull` / watchtower  |
| **åœ˜éšŠè¦æ¨¡** | 1-3 å€‹ Dev/Ops    | K8s å­¸ç¿’æ›²ç·šå¤ªé‡ï¼Œæˆæœ¬ä¸åˆ’ç®—               |

---

## ä½•æ™‚ *å¯èƒ½* éœ€è¦ k8sï¼ˆæˆ– k3sï¼‰ï¼Ÿ

| éœ€æ±‚             | èªªæ˜                                          |
| -------------- | ------------------------------------------- |
| **å¤šç¯€é»é«˜å¯ç”¨**     | æƒ³åš *Leaderâ€“Follower*ã€ç¯€é»æ•…éšœè‡ªå‹•é·ç§»               |
| **å½ˆæ€§æ“´ç¸®**       | æƒ³æ ¹æ“š NATS ä½‡åˆ—é•·åº¦æˆ– CPU è‡ªå‹•åŠ  Pod                  |
| **ç°åº¦â€§A/Bâ€§é‡‘çµ²é›€** | è¦åŒæ™‚è·‘ v1ã€v2ï¼Œæµé‡ 10%â†’90% æ¼¸é€²åˆ‡æ›                  |
| **å¤šåœ˜éšŠå”ä½œ**      | éœ€è¦ RBACã€LimitRangeã€NetworkPolicyâ€¦           |
| **é›²åŸç”Ÿæ²»ç†**      | æƒ³ç”¨ Argo Rollouts, KEDA, Prometheus Operator |

> âœ… è‹¥ä»¥ä¸Šæ²’æœ‰å…©é …åŒæ™‚å‘½ä¸­ï¼Œå°±å…ˆåˆ¥ä¸Š K8sã€‚

---

## ä½ çš„å°æœå‹™å¯ä½¿ç”¨çš„ *è¼•é‡è·¯å¾‘*

| é¸é …                                | é©åˆç‹€æ³                   | é—œéµé»                                                                                |
| --------------------------------- | ---------------------- | ---------------------------------------------------------------------------------- |
| **å–®æ©Ÿ `docker-compose` + systemd** | å–®ç¯€é»ã€ä½æµé‡                | - `docker-compose.yml` å·²æœ‰<br>- åŠ  systemd â†’ é–‹æ©Ÿè‡ªå•Ÿ<br>- ç”¨ *watchtower* è‡ªå‹•æ‹‰æœ€æ–° image é‡èµ· |
| **Docker Swarm**                  | æƒ³åšç°¡å–®å¤šç¯€é»ã€rolling update | - æŒ‡ä»¤è·Ÿ Compose å¹¾ä¹ä¸€è‡´<br>- å…§å»º overlay networkã€service scaling                         |
| **k3sï¼ˆå–®æ©Ÿæˆ– 2-3 ç¯€é»ï¼‰**               | æƒ³å˜—è©¦ K8s åˆæ€•é‡            | - ä¸€å€‹ binary + sqlite<br>- èˆ‡ K8s API 100% ç›¸å®¹<br>- å¯éš¨æ™‚å‡ç´šåˆ°å¤šç¯€é»                         |
| **Nomad + Consul**                | åªè¦æ’ç¨‹ã€ä¸æƒ³æ•´å¥— K8s          | - Hashicorp ç”Ÿæ…‹å–®ç´”<br>- job æª” YAML æ›´è¼•é‡                                               |

---

## ä½ çš„ç¾æœ‰æ¶æ§‹è¦æ€éº¼ã€Œå„ªé›…åœ°ç•™åœ¨ Composeã€

1. **åªæš´éœ²å¿…è¦åŸ å£**

   ```yaml
   content-writer-agent:
     expose: ["8003"]   # å…§ç¶²å¯ç”¨å³å¯
   ```
2. **çµ¦æ¯å€‹æœå‹™åŠ é‡å•Ÿç­–ç•¥ & è³‡æºä¸Šé™**

   ```yaml
   restart: always
   deploy:
     resources:
       limits:
         cpus: '0.3'
         memory: 256M
   ```
3. **ç”¨åå‘ä»£ç†çµ±ä¸€å‡ºå£**ï¼ˆTraefik / Nginxï¼‰

   * å¤–ç•Œåªè¦‹åˆ° `https://api.yoursite.com`
   * å…§éƒ¨è·¯ç”±åˆ° `orchestrator-agent:8000`ã€`form-api:8010`
4. **è‡ªå‹•éƒ¨ç½²**

   * GitHub Actions âœ Build & push image
   * SSH åˆ°ä¼ºæœå™¨åŸ·è¡Œ `docker compose pull && docker compose up -d`
5. **ç›£æ§ç…§ç”¨ Prometheus + Grafana**ï¼ˆä½ å·²ç¶“è·‘èµ·ä¾†ï¼‰

   * æ²’æœ‰ K8s ä¹Ÿèƒ½ scrape Docker / Node exporter

---

## å¦‚æœçœŸçš„è¦æº–å‚™ã€Œæœªä¾†å¯æ“´ã€ï¼Ÿ

* **å…ˆæŠŠéƒ¨ç½²ç¨¿åˆ†å±¤**

  1. `compose.yaml` for local
  2. `compose.prod.yaml` åŠ è³‡æºé™åˆ¶ã€ç§»é™¤æ¸¬è©¦æœå‹™
* **æŠŠç’°å¢ƒè®Šæ•¸é›†ä¸­åˆ° `/config/.env.prod`**
  å°‡ä¾†æ¬åˆ° K8s ConfigMap / Secrets å¾ˆç›´è¦º
* **æ’°å¯« Helm Chart ä½†ä¸éƒ¨ç½²**
  ç­‰å“ªå¤©è¦ç”¨ K8sï¼Œç›´æ¥ `helm install` å³å¯

---

### TL;DR

* **å°å‹å°ˆæ¡ˆ + å–®ç¯€é»** â‡’ `docker-compose` å·²ç¶“å¾ˆå¥½ç”¨ï¼Œä¸è¦ç¡¬ä¸Š K8sã€‚
* **çœŸçš„è¦é«˜å¯ç”¨ / éœ€è¦è‡ªå‹•æ“´ç¸®** â‡’ å†è©•ä¼° k3s æˆ–é›²ç«¯è¨—ç®¡ K8sã€‚
* å…ˆæŠŠè³‡æºé™åˆ¶ã€åå‘ä»£ç†ã€CI/CDã€ç›£æ§é¡§å¥½ï¼Œæ¯”ã€Œæœå‹™æ•¸é‡ã€æ›´é‡è¦ã€‚

é€™æ¨£å°±èƒ½åœ¨ **ä¿æŒç°¡å–®** çš„åŒæ™‚ï¼Œç•™ä¸‹ **éš¨æ™‚å¯å‡ç´š** çš„å½ˆæ€§ã€‚
