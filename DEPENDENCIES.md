# ðŸ“¦ ä¾è³´ç®¡ç†æŒ‡å—

## pyproject.toml ç¾ä»£åŒ–ä¾è³´ç®¡ç†

æœ¬å°ˆæ¡ˆä½¿ç”¨ `pyproject.toml` é€²è¡Œç¾ä»£åŒ–çš„ Python ä¾è³´ç®¡ç†ï¼Œæ”¯æ´æ¨¡çµ„åŒ–å®‰è£å’Œéˆæ´»çš„åŠŸèƒ½çµ„åˆã€‚

### ðŸŽ¯ æ ¸å¿ƒç†å¿µ

- **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šæŒ‰åŠŸèƒ½åˆ†çµ„ä¾è³´ï¼ŒæŒ‰éœ€å®‰è£
- **ç‰ˆæœ¬æŽ§åˆ¶**ï¼šç²¾ç¢ºçš„ç‰ˆæœ¬ç¯„åœç®¡ç†
- **é–‹ç™¼å‹å¥½**ï¼šé–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒåˆ†é›¢
- **æ“´å±•æ€§**ï¼šè¼•é¬†æ·»åŠ æ–°åŠŸèƒ½æ¨¡çµ„

### ðŸ“‹ ä¾è³´åˆ†çµ„

#### æ ¸å¿ƒä¾è³´ï¼ˆå¿…éœ€ï¼‰
```toml
dependencies = [
    "fastapi>=0.104.1,<0.105.0",      # Web æ¡†æž¶
    "uvicorn[standard]>=0.24.0",       # ASGI æœå‹™å™¨
    "pydantic>=2.5.0,<3.0.0",         # æ•¸æ“šé©—è­‰
    "apify-client>=1.7.1,<2.0.0",     # çˆ¬èŸ²å®¢æˆ¶ç«¯
    "httpx>=0.25.2,<0.26.0",          # HTTP å®¢æˆ¶ç«¯
    # ... å…¶ä»–æ ¸å¿ƒä¾è³´
]
```

#### å¯é¸ä¾è³´çµ„

| çµ„å | ç”¨é€” | ä¸»è¦åŒ… |
|------|------|--------|
| `ai` | AI å’Œ LLM åŠŸèƒ½ | google-generativeai, openai |
| `ui` | Web ç”¨æˆ¶ä»‹é¢ | streamlit |
| `database` | æ•¸æ“šæŒä¹…åŒ– | sqlalchemy, asyncpg |
| `messaging` | è¨Šæ¯ä½‡åˆ— | redis, nats-py |
| `monitoring` | ç›£æŽ§è¿½è¹¤ | opentelemetry, prometheus |
| `data` | æ•¸æ“šè™•ç† | pandas, numpy |
| `security` | å®‰å…¨èªè­‰ | bcrypt, python-jose |
| `dev` | é–‹ç™¼å·¥å…· | pytest, black, mypy |

### ðŸš€ å®‰è£æ–¹å¼

#### åŸºç¤Žå®‰è£
```bash
# åªå®‰è£æ ¸å¿ƒåŠŸèƒ½ï¼ˆçˆ¬èŸ²ï¼‰
pip install -e .
```

#### åŠŸèƒ½æ¨¡çµ„å®‰è£
```bash
# å®‰è£ AI åŠŸèƒ½
pip install -e .[ai]

# å®‰è£ UI åŠŸèƒ½
pip install -e .[ui]

# å®‰è£è³‡æ–™åº«åŠŸèƒ½
pip install -e .[database]

# çµ„åˆå®‰è£
pip install -e .[ai,ui,database]
```

#### é è¨­çµ„åˆ
```bash
# å®Œæ•´åŠŸèƒ½ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
pip install -e .[full]

# ç”Ÿç”¢ç’°å¢ƒï¼ˆä¸å«é–‹ç™¼å·¥å…·ï¼‰
pip install -e .[production]

# é–‹ç™¼ç’°å¢ƒ
pip install -e .[dev]
```

### ðŸ”§ é–‹ç™¼å·¥å…·æ•´åˆ

#### ä»£ç¢¼æ ¼å¼åŒ–
```bash
# ä½¿ç”¨ hatch ç’°å¢ƒ
hatch run format

# æˆ–ç›´æŽ¥ä½¿ç”¨å·¥å…·
black .
isort .
```

#### ä»£ç¢¼æª¢æŸ¥
```bash
# å®Œæ•´æª¢æŸ¥
hatch run check

# å–®ç¨æª¢æŸ¥
hatch run lint
hatch run test
```

#### æ¸¬è©¦åŸ·è¡Œ
```bash
# åŸºæœ¬æ¸¬è©¦
hatch run test

# è¦†è“‹çŽ‡æ¸¬è©¦
hatch run test-cov

# å¿«é€Ÿæ¸¬è©¦
hatch run test-fast
```

### ðŸ“Š ä¾è³´ç‰ˆæœ¬ç­–ç•¥

#### ç‰ˆæœ¬ç¯„åœç­–ç•¥
- **å¯¬é¬†ç­–ç•¥**ï¼š`>=X.Y.Z` - å…è¨±æ‰€æœ‰å¾ŒçºŒç‰ˆæœ¬ï¼Œç²å¾—æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨æ›´æ–°
- **åƒ…åœ¨å¿…è¦æ™‚é™åˆ¶**ï¼šåªæœ‰åœ¨å·²çŸ¥ç‰ˆæœ¬è¡çªæ™‚æ‰è¨­ç½®ä¸Šé™
- **æœ€å°ç‰ˆæœ¬è¦æ±‚**ï¼šè¨­ç½®å·²æ¸¬è©¦çš„æœ€ä½Žç‰ˆæœ¬ä½œç‚ºä¸‹é™

#### ç¯„ä¾‹èªªæ˜Ž
```toml
"fastapi>=0.100.0"        # å…è¨±æ‰€æœ‰ 0.100.0 ä»¥ä¸Šç‰ˆæœ¬
"pydantic>=2.0.0"         # å…è¨±æ‰€æœ‰ 2.x ç‰ˆæœ¬
"apify-client>=1.0.0"     # å…è¨±æ‰€æœ‰ 1.x ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æœ€æ–°çš„ 1.12.0
```

#### å„ªå‹¢
- âœ… è‡ªå‹•ç²å¾—æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨æ›´æ–°
- âœ… é¿å…ä¾è³´éŽæ™‚å•é¡Œ
- âœ… æ¸›å°‘ç‰ˆæœ¬è¡çª
- âœ… æ›´å¥½çš„ç”Ÿæ…‹ç³»çµ±å…¼å®¹æ€§

### ðŸŽ¯ ä½¿ç”¨å ´æ™¯

#### å ´æ™¯ 1ï¼šåŸºç¤Žçˆ¬èŸ²é–‹ç™¼
```bash
# åªéœ€è¦çˆ¬èŸ²åŠŸèƒ½
pip install -e .

# æ¸¬è©¦çˆ¬èŸ²
python test_crawler.py
```

#### å ´æ™¯ 2ï¼šæ·»åŠ  AI åˆ†æžåŠŸèƒ½
```bash
# æ·»åŠ  AI ä¾è³´
pip install -e .[ai]

# ç¾åœ¨å¯ä»¥ä½¿ç”¨ Gemini API
```

#### å ´æ™¯ 3ï¼šå®Œæ•´ç³»çµ±é–‹ç™¼
```bash
# å®‰è£æ‰€æœ‰åŠŸèƒ½
pip install -e .[full,dev]

# é–‹å§‹å®Œæ•´é–‹ç™¼
hatch run dev
```

#### å ´æ™¯ 4ï¼šç”Ÿç”¢éƒ¨ç½²
```bash
# åªå®‰è£ç”Ÿç”¢éœ€è¦çš„ä¾è³´
pip install -e .[production]

# ä¸åŒ…å«é–‹ç™¼å·¥å…·ï¼Œæ¸›å°‘å®¹å™¨å¤§å°
```

### ðŸ”„ ä¾è³´æ›´æ–°æµç¨‹

#### 1. æª¢æŸ¥éŽæœŸä¾è³´
```bash
pip list --outdated
```

#### 2. æ›´æ–° pyproject.toml
```toml
# æ›´æ–°ç‰ˆæœ¬ç¯„åœ
"fastapi>=0.105.0,<0.106.0"  # å¾ž 0.104.x å‡ç´šåˆ° 0.105.x
```

#### 3. æ¸¬è©¦å…¼å®¹æ€§
```bash
# é‡æ–°å®‰è£
pip install -e .[dev]

# é‹è¡Œæ¸¬è©¦
hatch run test
```

#### 4. éŽ–å®šç‰ˆæœ¬ï¼ˆå¯é¸ï¼‰
```bash
# ç”ŸæˆéŽ–å®šæª”æ¡ˆ
pip freeze > requirements-lock.txt
```

### ðŸ³ Docker æ•´åˆ

#### Dockerfile ç¯„ä¾‹
```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY pyproject.toml .

# åªå®‰è£ç”Ÿç”¢ä¾è³´
RUN pip install -e .[production]

COPY . .
CMD ["uvicorn", "agents.crawler.main:app", "--host", "0.0.0.0"]
```

#### å¤šéšŽæ®µæ§‹å»º
```dockerfile
# é–‹ç™¼éšŽæ®µ
FROM python:3.11 as development
RUN pip install -e .[full,dev]

# ç”Ÿç”¢éšŽæ®µ
FROM python:3.11-slim as production
RUN pip install -e .[production]
```

### ðŸ“ˆ æ“´å±•æ–°åŠŸèƒ½

#### æ·»åŠ æ–°çš„ä¾è³´çµ„
```toml
[project.optional-dependencies]
# æ–°å¢žæ©Ÿå™¨å­¸ç¿’åŠŸèƒ½
ml = [
    "scikit-learn>=1.3.0,<2.0.0",
    "torch>=2.0.0,<3.0.0",
    "transformers>=4.30.0,<5.0.0",
]

# æ–°å¢žåœ–åƒè™•ç†åŠŸèƒ½
image = [
    "pillow>=10.0.0,<11.0.0",
    "opencv-python>=4.8.0,<5.0.0",
]
```

#### ä½¿ç”¨æ–°åŠŸèƒ½
```bash
# å®‰è£æ–°åŠŸèƒ½
pip install -e .[ml,image]

# çµ„åˆä½¿ç”¨
pip install -e .[ai,ml,image]
```

### ðŸ” æ•…éšœæŽ’é™¤

#### å¸¸è¦‹å•é¡Œ

1. **ä¾è³´è¡çª**
```bash
# æª¢æŸ¥ä¾è³´æ¨¹
pip show package-name

# è§£æ±ºè¡çª
pip install --upgrade package-name
```

2. **ç‰ˆæœ¬ä¸å…¼å®¹**
```bash
# æª¢æŸ¥å…¼å®¹æ€§
pip check

# é™ç´šåˆ°å…¼å®¹ç‰ˆæœ¬
pip install "package-name<version"
```

3. **å®‰è£å¤±æ•—**
```bash
# æ¸…ç†å¿«å–
pip cache purge

# é‡æ–°å®‰è£
pip install --no-cache-dir -e .
```

### ðŸ“š æœ€ä½³å¯¦è¸

#### 1. ç‰ˆæœ¬ç®¡ç†
- ä½¿ç”¨èªžç¾©åŒ–ç‰ˆæœ¬æŽ§åˆ¶
- å®šæœŸæ›´æ–°ä¾è³´
- æ¸¬è©¦æ–°ç‰ˆæœ¬å…¼å®¹æ€§

#### 2. æ¨¡çµ„è¨­è¨ˆ
- æŒ‰åŠŸèƒ½åˆ†çµ„ä¾è³´
- é¿å…å¾ªç’°ä¾è³´
- ä¿æŒæ ¸å¿ƒä¾è³´æœ€å°åŒ–

#### 3. é–‹ç™¼æµç¨‹
- ä½¿ç”¨è™›æ“¬ç’°å¢ƒ
- éŽ–å®šç”Ÿç”¢ç‰ˆæœ¬
- è‡ªå‹•åŒ–æ¸¬è©¦

#### 4. éƒ¨ç½²ç­–ç•¥
- åˆ†é›¢é–‹ç™¼å’Œç”Ÿç”¢ä¾è³´
- ä½¿ç”¨å¤šéšŽæ®µ Docker æ§‹å»º
- ç›£æŽ§ä¾è³´å®‰å…¨æ€§

---

**ç¸½çµ**ï¼špyproject.toml æä¾›äº†ç¾ä»£åŒ–ã€éˆæ´»çš„ä¾è³´ç®¡ç†æ–¹å¼ï¼Œæ”¯æ´æ¨¡çµ„åŒ–å®‰è£å’Œç²¾ç¢ºçš„ç‰ˆæœ¬æŽ§åˆ¶ï¼Œè®“å°ˆæ¡ˆæ›´æ˜“ç¶­è­·å’Œæ“´å±•ã€‚