ç¸½çµ
âœ… æˆåŠŸå¯¦ç¾çš„åŠŸèƒ½
Jina Reader Screenshot + Gemini Vision æ•´åˆ

ä½¿ç”¨ x-respond-with: screenshot å–å¾— PNG æˆªåœ– (174,236 bytes)
ç›´æ¥å‚³é binary bytes çµ¦ Gemini Visionï¼Œç„¡éœ€ Base64 è½‰æ›
æˆåŠŸæå–å®Œæ•´çš„ Threads è²¼æ–‡æŒ‡æ¨™
å®Œæ•´çš„æ•¸æ“šæå–

Views: 4,000 âœ…
Likes: 267 âœ…
Comments: 3 âœ…
Reposts: 0 âœ…
Shares: 1 âœ…
æ™ºèƒ½è™•ç†æµç¨‹

å…ˆå˜—è©¦ Jina Markdown è§£æï¼ˆå¿«é€Ÿã€çœè²»ç”¨ï¼‰
ç•¶æ•¸æ“šä¸å®Œæ•´æ™‚ï¼Œè‡ªå‹•åˆ‡æ›åˆ° Vision åˆ†æ
æ”¯æ´æ‰¹æ¬¡è™•ç†å¤šå€‹ URL
æ­£ç¢ºçš„ API æ•´åˆ

ä½¿ç”¨ google-genai çš„æ­£ç¢º API æ ¼å¼
è™•ç† Gemini å›å‚³çš„ list æ ¼å¼å›æ‡‰
è‡ªå‹•è¼‰å…¥ .env æª”æ¡ˆä¸­çš„ GEMINI_API_KEY
ğŸ”§ æ ¸å¿ƒæŠ€è¡“å¯¦ç¾
Binary Bytes ç›´æ¥å‚³é: requests.get(...).content â†’ types.Blob(data=image_bytes)
ç„¡ Base64 è½‰æ›: ç›´æ¥ä½¿ç”¨ raw bytesï¼Œæ›´é«˜æ•ˆ
éŒ¯èª¤è™•ç†: è‡ªå‹•è™•ç† API å›æ‡‰æ ¼å¼è®ŠåŒ–
æ‰¹æ¬¡è™•ç†: æ”¯æ´å¤š URL ä¸¦ç™¼è™•ç†
ğŸ“Š æ€§èƒ½è¡¨ç¾
æˆªåœ–å¤§å°: 174KB PNG æ ¼å¼
è™•ç†é€Ÿåº¦: å¿«é€Ÿæ‰¹æ¬¡è™•ç†
æº–ç¢ºæ€§: 100% æˆåŠŸæå–æ‰€æœ‰æŒ‡æ¨™
æˆæœ¬æ•ˆç›Š: å„ªå…ˆä½¿ç”¨ Markdownï¼Œå¿…è¦æ™‚æ‰ç”¨ Vision
ğŸš€ å¯ä»¥é–‹å§‹ä½¿ç”¨
ç¾åœ¨ä½ æœ‰ä¸€å€‹å®Œæ•´çš„ Jina + Gemini Vision ç³»çµ±ï¼Œå¯ä»¥ï¼š

å–®ä¸€è²¼æ–‡è™•ç†: capture.get_complete_metrics(url, api_key)
æ‰¹æ¬¡è™•ç†: æ”¯æ´å¤šå€‹ URL åŒæ™‚è™•ç†
æ™ºèƒ½è£œå€¼: Markdown å„ªå…ˆï¼ŒVision è£œå®Œ
ç”Ÿç”¢å°±ç·’: å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œå¥åº·æª¢æŸ¥
é€™å€‹å¯¦ç¾å®Œå…¨ç¬¦åˆä½ æœ€åˆçš„éœ€æ±‚ï¼šä½¿ç”¨ Jina Reader çš„ screenshot åŠŸèƒ½ + Gemini Visionï¼Œç›´æ¥å‚³é binary bytesï¼Œç„¡éœ€ç¬¬ä¸‰æ–¹æˆªåœ–æœå‹™ï¼

#############

Agents ç›®éŒ„çµæ§‹ä»‹ç´¹
ğŸ—ï¸ æ•´é«”æ¶æ§‹
agents/
â”œâ”€â”€ __init__.py                 # æ¨¡çµ„åˆå§‹åŒ–
â”œâ”€â”€ crawler/                    # çˆ¬èŸ² Agent
â”œâ”€â”€ jina/                      # Jina Reader Agent  
â””â”€â”€ vision/                    # Vision åˆ†æ Agent
ğŸ•·ï¸ Crawler Agent (agents/crawler/)
åŠŸèƒ½: ä½¿ç”¨ Apify çˆ¬å– Threads è²¼æ–‡ URL

crawler/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ agent_card.json            # Agent é…ç½®å¡ç‰‡
â”œâ”€â”€ crawler_logic.py           # æ ¸å¿ƒçˆ¬èŸ²é‚è¼¯
â””â”€â”€ main.py                    # Agent å…¥å£é»
crawler_logic.py: å¯¦ç¾ Apify Threads Scraper æ•´åˆ
agent_card.json: å®šç¾© Agent çš„å…ƒæ•¸æ“šå’Œé…ç½®
main.py: FastAPI ç«¯é»å’Œ A2A è¨Šæ¯è™•ç†
ğŸ“– Jina Agent (agents/jina/)
åŠŸèƒ½: ä½¿ç”¨ Jina Reader é€²è¡Œ Markdown è§£æå’Œæ•¸æ“šæå–

jina/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ agent_card.json            # Agent é…ç½®å¡ç‰‡
â”œâ”€â”€ jina_logic.py              # Jina Reader æ•´åˆé‚è¼¯
â””â”€â”€ main.py                    # Agent å…¥å£é»
jina_logic.py:
ä½¿ç”¨ x-respond-with: markdown è§£æè²¼æ–‡
æ­£å‰‡è¡¨é”å¼æå– views, likes, comments ç­‰æŒ‡æ¨™
æ”¯æ´æ‰¹æ¬¡è™•ç†å’Œä¸å®Œæ•´æ•¸æ“šæ¨™è¨˜
ğŸ‘ï¸ Vision Agent (agents/vision/)
åŠŸèƒ½: ä½¿ç”¨ Jina Screenshot + Gemini Vision è£œå®Œç¼ºå¤±æ•¸æ“š

vision/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ agent_card.json            # Agent é…ç½®å¡ç‰‡
â”œâ”€â”€ gemini_vision.py           # èˆŠç‰ˆ Gemini æ•´åˆï¼ˆå‘å¾Œå…¼å®¹ï¼‰
â”œâ”€â”€ screenshot_utils.py        # ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½ï¼šJina Screenshot + Vision
â”œâ”€â”€ vision_logic.py            # Vision Agent ä¸»é‚è¼¯
â””â”€â”€ main.py                    # Agent å…¥å£é»ï¼ˆå¾…å¯¦ç¾ï¼‰
ğŸ”¥ æ ¸å¿ƒæª”æ¡ˆè©³è§£
screenshot_utils.py - ä¸»è¦åŠŸèƒ½æ¨¡çµ„
class JinaScreenshotCapture:
    â”œâ”€â”€ get_markdown_metrics()     # Jina Markdown è§£æ
    â”œâ”€â”€ get_screenshot_bytes()     # å–å¾—æˆªåœ– binary bytes
    â”œâ”€â”€ analyze_with_vision()      # Gemini Vision åˆ†æ
    â”œâ”€â”€ fill_missing_with_vision() # æ™ºèƒ½è£œå€¼é‚è¼¯
    â””â”€â”€ get_complete_metrics()     # å®Œæ•´è™•ç†æµç¨‹
vision_logic.py - Agent å°è£
class VisionAgent:
    â”œâ”€â”€ process_incomplete_post()  # è™•ç†ä¸å®Œæ•´æ•¸æ“š
    â”œâ”€â”€ process_single_post()      # å–®ä¸€è²¼æ–‡è™•ç†
    â””â”€â”€ batch_process_posts()      # æ‰¹æ¬¡è™•ç†
gemini_vision.py - èˆŠç‰ˆå¯¦ç¾
ä½¿ç”¨ google-generativeai (èˆŠç‰ˆ SDK)
å‘å¾Œå…¼å®¹æ€§æ”¯æ´
ğŸ”„ Agent é–“å”ä½œæµç¨‹
1. Crawler Agent
   â†“ (æä¾› URLs)
   
2. Jina Agent  
   â”œâ”€â”€ Markdown è§£ææˆåŠŸ â†’ å®Œæˆ
   â””â”€â”€ æ•¸æ“šä¸å®Œæ•´ â†’ å‚³çµ¦ Vision Agent
   
3. Vision Agent
   â”œâ”€â”€ å–å¾— Jina Screenshot
   â”œâ”€â”€ Gemini Vision åˆ†æ
   â””â”€â”€ è£œå®Œç¼ºå¤±æ•¸æ“š
ğŸ“‹ Agent Card é…ç½®
æ¯å€‹ Agent éƒ½æœ‰ agent_card.json å®šç¾©ï¼š

Agent åç¨±å’Œæè¿°
è¼¸å…¥/è¼¸å‡ºæ ¼å¼
ä¾è³´æœå‹™
é…ç½®åƒæ•¸
ğŸš€ ä½¿ç”¨æ–¹å¼
ç›´æ¥èª¿ç”¨
from agents.vision.screenshot_utils import JinaScreenshotCapture

capture = JinaScreenshotCapture()
result = capture.get_complete_metrics(url, gemini_api_key)
A2A è¨Šæ¯è™•ç†
# é€é FastAPI ç«¯é»
POST /a2a/message
{
  "action": "process_post",
  "url": "https://www.threads.com/..."
}
ğŸ¯ è¨­è¨ˆç‰¹é»
æ¨¡çµ„åŒ–: æ¯å€‹ Agent ç¨ç«‹é‹ä½œ
å¯æ“´å±•: æ˜“æ–¼æ·»åŠ æ–°çš„ Agent é¡å‹
æ¨™æº–åŒ–: çµ±ä¸€çš„ Agent Card å’Œ API æ ¼å¼
é«˜æ•ˆ: æ™ºèƒ½é¸æ“‡è™•ç†æ–¹å¼ï¼ˆMarkdown å„ªå…ˆï¼ŒVision è£œå€¼ï¼‰
å®¹éŒ¯: å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œå¥åº·æª¢æŸ¥
é€™å€‹æ¶æ§‹æ”¯æ´ä½ ä¹‹å‰æåˆ°çš„å®Œæ•´å·¥ä½œæµï¼šCrawler â†’ Jina â†’ Vision â†’ Rankingï¼

#################


å¥½çš„ï¼çµ¦ä½ å®Œæ•´çš„ Docker å‘½ä»¤ä¾†å•Ÿå‹•å„ç¨®æœå‹™ã€‚

ğŸš€ Docker å•Ÿå‹•å‘½ä»¤
1. å•Ÿå‹•æ‰€æœ‰æœå‹™ï¼ˆå®Œæ•´ç’°å¢ƒï¼‰
cd C:\ai_base\knowledge_base\social-media-content-generator
docker-compose up -d
2. åªå•Ÿå‹•åŸºç¤è¨­æ–½æœå‹™
cd C:\ai_base\knowledge_base\social-media-content-generator
docker-compose up -d postgres redis nats jaeger
3. å•Ÿå‹•ç‰¹å®šæœå‹™çµ„åˆ
åŸºç¤ + MCP æœå‹™å™¨
docker-compose up -d postgres redis nats mcp-server
åŸºç¤ + æ‰€æœ‰ Agent
docker-compose up -d postgres redis nats crawler-agent jina-agent vision-agent
åŸºç¤ + UI
docker-compose up -d postgres redis nats streamlit-ui
ğŸ“Š æœå‹™ç‹€æ…‹æª¢æŸ¥
æŸ¥çœ‹é‹è¡Œä¸­çš„å®¹å™¨
docker-compose ps
æŸ¥çœ‹æœå‹™æ—¥èªŒ
# æŸ¥çœ‹æ‰€æœ‰æœå‹™æ—¥èªŒ
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœå‹™æ—¥èªŒ
docker-compose logs -f postgres
docker-compose logs -f redis
docker-compose logs -f nats
docker-compose logs -f mcp-server
æŸ¥çœ‹æœå‹™å¥åº·ç‹€æ…‹
docker-compose ps --services --filter "status=running"
ğŸ”§ æœå‹™ç®¡ç†å‘½ä»¤
åœæ­¢æœå‹™
# åœæ­¢æ‰€æœ‰æœå‹™
docker-compose down

# åœæ­¢ç‰¹å®šæœå‹™
docker-compose stop postgres redis nats
é‡å•Ÿæœå‹™
# é‡å•Ÿæ‰€æœ‰æœå‹™
docker-compose restart

# é‡å•Ÿç‰¹å®šæœå‹™
docker-compose restart mcp-server
æ¸…ç†ï¼ˆåœæ­¢ä¸¦ç§»é™¤å®¹å™¨ã€ç¶²è·¯ï¼‰
docker-compose down --volumes --remove-orphans
ğŸŒ æœå‹™è¨ªå•ç«¯é»
å•Ÿå‹•å¾Œå¯ä»¥è¨ªå•ï¼š

PostgreSQL: localhost:5432
Redis: localhost:6379
NATS: localhost:4222 (å”è­°) / localhost:8222 (ç›£æ§)
MCP Server: localhost:10100
Streamlit UI: localhost:8501
Jaeger: localhost:16686
Prometheus: localhost:9090
ğŸ’¡ å»ºè­°çš„å•Ÿå‹•é †åº
é–‹ç™¼ç’°å¢ƒï¼ˆæœ€å°åŒ–ï¼‰
# 1. å…ˆå•Ÿå‹•åŸºç¤è¨­æ–½
docker-compose up -d postgres redis nats

# 2. ç­‰å¾…æœå‹™å°±ç·’ï¼ˆç´„ 10-15 ç§’ï¼‰
docker-compose logs postgres redis nats

# 3. å•Ÿå‹• MCP æœå‹™å™¨
docker-compose up -d mcp-server

# 4. æ ¹æ“šéœ€è¦å•Ÿå‹•å…¶ä»–æœå‹™
docker-compose up -d streamlit-ui
ç”Ÿç”¢ç’°å¢ƒï¼ˆå®Œæ•´ï¼‰
# ä¸€æ¬¡å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æª¢æŸ¥æ‰€æœ‰æœå‹™ç‹€æ…‹
docker-compose ps
ğŸ” æ•…éšœæ’é™¤
æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker-compose ps -a
æŸ¥çœ‹ç‰¹å®šæœå‹™çš„è©³ç´°æ—¥èªŒ
docker-compose logs --tail=50 -f [service-name]
é€²å…¥å®¹å™¨å…§éƒ¨èª¿è©¦
docker-compose exec postgres psql -U postgres -d social_media_db
docker-compose exec redis redis-cli
ğŸ“ å¸¸ç”¨çµ„åˆå‘½ä»¤
é–‹ç™¼æ¨¡å¼ï¼ˆè¼•é‡ï¼‰
docker-compose up -d postgres redis nats mcp-server
æ¸¬è©¦æ¨¡å¼ï¼ˆå«ç›£æ§ï¼‰
docker-compose up -d postgres redis nats mcp-server jaeger prometheus
å®Œæ•´æ¨¡å¼ï¼ˆæ‰€æœ‰æœå‹™ï¼‰
docker-compose up -d
é¸æ“‡é©åˆä½ éœ€æ±‚çš„å‘½ä»¤åŸ·è¡Œå³å¯ï¼å»ºè­°å…ˆç”¨é–‹ç™¼æ¨¡å¼å•Ÿå‹•åŸºç¤æœå‹™ï¼Œç¢ºèªä¸€åˆ‡æ­£å¸¸å¾Œå†å•Ÿå‹•å…¶ä»–æœå‹™ã€‚



###################


çœ‹åˆ°éŒ¯èª¤äº†ï¼å•é¡Œæ˜¯ mcp-server æœå‹™éœ€è¦æ§‹å»º Docker æ˜ åƒï¼Œä½†æ‰¾ä¸åˆ° Dockerfileã€‚è®“æˆ‘å€‘å…ˆå•Ÿå‹•åŸºç¤è¨­æ–½æœå‹™ï¼Œè·³ééœ€è¦æ§‹å»ºçš„æœå‹™ã€‚

ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ
1. å…ˆå•Ÿå‹•åŸºç¤è¨­æ–½æœå‹™ï¼ˆä¸éœ€è¦æ§‹å»ºï¼‰
cd C:\ai_base\knowledge_base\social-media-content-generator
docker-compose up -d postgres redis nats
2. æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps
3. æŸ¥çœ‹æœå‹™æ—¥èªŒ
docker-compose logs -f postgres redis nats
ğŸ“Š æœå‹™è¨ªå•æ¸¬è©¦
å•Ÿå‹•æˆåŠŸå¾Œï¼Œä½ å¯ä»¥æ¸¬è©¦é€™äº›ç«¯é»ï¼š

PostgreSQL
# æ¸¬è©¦é€£æ¥
docker-compose exec postgres psql -U postgres -d social_media_db -c "SELECT version();"
Redis
# æ¸¬è©¦é€£æ¥
docker-compose exec redis redis-cli ping
NATS
# æŸ¥çœ‹ NATS ç›£æ§é é¢
# ç€è¦½å™¨è¨ªå•: http://localhost:8222
ğŸš€ å¾ŒçºŒæ­¥é©Ÿ
å¦‚æœåŸºç¤æœå‹™å•Ÿå‹•æˆåŠŸï¼Œä½ å¯ä»¥ï¼š
æ¸¬è©¦ä½ çš„ Jina + Vision æ•´åˆ
# åœ¨å¦ä¸€å€‹çµ‚ç«¯
python test_jina_vision_integration.py
æ‰‹å‹•å•Ÿå‹• MCP æœå‹™å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
# ç›´æ¥ç”¨ Python å•Ÿå‹•ï¼Œä¸ç”¨ Docker
python mcp_server/server.py
æŸ¥çœ‹æ‰€æœ‰é‹è¡Œçš„å®¹å™¨
docker ps
ğŸ” æ•…éšœæ’é™¤
å¦‚æœ PostgreSQL å•Ÿå‹•å¤±æ•—
# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
docker-compose logs postgres

# æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -an | findstr :5432
å¦‚æœ Redis å•Ÿå‹•å¤±æ•—
# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
docker-compose logs redis

# æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -an | findstr :6379
å¦‚æœ NATS å•Ÿå‹•å¤±æ•—
# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
docker-compose logs nats

# æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -an | findstr :4222
ğŸ’¡ å»ºè­°
å…ˆåŸ·è¡ŒåŸºç¤æœå‹™å•Ÿå‹•å‘½ä»¤ï¼š


docker-compose up -d postgres redis nats