# Threads çˆ¬èŸ²æ ¸å¿ƒæŠ€è¡“çªç ´å ±å‘Š - é—œéµæ¬„ä½æå–ç­–ç•¥

## ğŸ¯ æ ¸å¿ƒçªç ´é»

æœ¬å ±å‘Šå°ˆæ³¨æ–¼ Threads çˆ¬èŸ²æœ€é›£è§£æ±ºçš„æ ¸å¿ƒå•é¡Œï¼š**å¦‚ä½•åœ¨å¹³å°é »ç¹è®Šæ›´çš„æƒ…æ³ä¸‹ï¼Œç©©å®šæå–é—œéµæ¬„ä½æ•¸æ“š**ã€‚

## ğŸ” é—œéµæŠ€è¡“æŒ‘æˆ°èˆ‡çªç ´ç­–ç•¥

### æŒ‘æˆ° 1: è¨ˆæ•¸æ¬„ä½ (likes, comments, reposts, shares) æå–å¤±æ•—

#### å•é¡Œæ ¸å¿ƒ
- **DOM é¸æ“‡å™¨ä¸ç©©å®š**: Threads çš„ CSS é¡åç¶“å¸¸è®Šæ›´ï¼Œå‚³çµ±é¸æ“‡å™¨å¤±æ•ˆç‡é«˜é” 70%
- **JavaScript å‹•æ…‹æ¸²æŸ“**: è¨ˆæ•¸æ•¸æ“šé€šé AJAX å‹•æ…‹è¼‰å…¥ï¼Œé é¢åˆå§‹ HTML ä¸­ä¸åŒ…å«å¯¦éš›æ•¸å€¼
- **åœ‹éš›åŒ–å•é¡Œ**: ä¸åŒèªè¨€ç’°å¢ƒä¸‹è¨ˆæ•¸é¡¯ç¤ºæ ¼å¼å·®ç•°å·¨å¤§

#### é—œéµçªç ´ç­–ç•¥

**ç­–ç•¥ 1: GraphQL æŸ¥è©¢åç¨±æ””æˆª**
```python
# é—œéµç™¼ç¾ï¼šæ””æˆªç‰¹å®šçš„ GraphQL æŸ¥è©¢è€Œéä¾è³´ DOM
query_name = headers.get("x-fb-friendly-name", "")
if "useBarcelonaBatchedDynamicPostCountsSubscriptionQuery" in query_name:
```

**ç‚ºä»€éº¼é€™å€‹ç­–ç•¥æœ‰æ•ˆï¼Ÿ**
1. **æŸ¥è©¢åç¨±ç©©å®šæ€§**: Facebook/Meta çš„ GraphQL æŸ¥è©¢åç¨±è®Šæ›´é »ç‡é ä½æ–¼ DOM çµæ§‹
2. **æ•¸æ“šæºé ­æ€§**: ç›´æ¥å¾ API éŸ¿æ‡‰ç²å–ï¼Œé¿å… DOM æ¸²æŸ“çš„ä¸ç¢ºå®šæ€§
3. **æ‰¹é‡è™•ç†å„ªå‹¢**: ä¸€æ¬¡éŸ¿æ‡‰åŒ…å«å¤šå€‹è²¼æ–‡çš„è¨ˆæ•¸æ•¸æ“š

**å®¹éŒ¯æ©Ÿåˆ¶**:
```python
# ç²¾ç¢ºè²¼æ–‡åŒ¹é… - é—œéµæŠ€è¡“é»
target_code = re.search(r'/post/([^/?]+)', post.url).group(1)
for post_data in posts_list:
    if post_data.get("code") == target_code:
        # ç¢ºä¿åŒ¹é…åˆ°æ­£ç¢ºçš„è²¼æ–‡
```

#### æ‡‰å°æœªä¾†è®Šæ›´çš„ç­–ç•¥
1. **æŸ¥è©¢åç¨±ç›£æ§**: å®šæœŸæª¢æŸ¥æ–°çš„ GraphQL æŸ¥è©¢åç¨±æ¨¡å¼
2. **å¤šæŸ¥è©¢å‚™æ´**: åŒæ™‚ç›£è½å¤šå€‹å¯èƒ½çš„è¨ˆæ•¸æŸ¥è©¢
3. **éŸ¿æ‡‰çµæ§‹é©é…**: å‹•æ…‹è§£æä¸åŒçš„ JSON çµæ§‹

---

### æŒ‘æˆ° 2: å½±ç‰‡æ¬„ä½æª¢æ¸¬èˆ‡URLæå–

#### å•é¡Œæ ¸å¿ƒ
- **æ‡¶è¼‰å…¥æ©Ÿåˆ¶**: Threads å½±ç‰‡éœ€è¦ç”¨æˆ¶äº’å‹•æ‰é–‹å§‹è¼‰å…¥
- **éš±è—çš„ç¶²è·¯è«‹æ±‚**: å½±ç‰‡ URL é€šéå¾Œå° XHR è«‹æ±‚ç²å–ï¼Œä¸åœ¨ DOM ä¸­
- **å¤šæ ¼å¼æ”¯æ´**: å½±ç‰‡å¯èƒ½æ˜¯ MP4ã€M3U8ã€MPD ç­‰å¤šç¨®æ ¼å¼

#### é—œéµçªç ´ç­–ç•¥

**ç­–ç•¥ 1: ç¶²è·¯è³‡æºæ””æˆª**
```python
# é—œéµæŠ€è¡“ï¼šæ””æˆª media é¡å‹çš„ç¶²è·¯è«‹æ±‚
resource_type = response.request.resource_type
content_type = response.headers.get("content-type", "")

if (resource_type == "media" or 
    content_type.startswith("video/") or
    any(ext in response.url.lower() for ext in [".mp4", ".m3u8", ".mpd"])):
    video_urls.add(response.url)
```

**ç­–ç•¥ 2: ä¸»å‹•è§¸ç™¼è¼‰å…¥**
```python
# æ¨¡æ“¬ç”¨æˆ¶äº’å‹•è§¸ç™¼å½±ç‰‡è¼‰å…¥
trigger_selectors = [
    'div[data-testid="media-viewer"]',  # ä¸»è¦åª’é«”å®¹å™¨
    'video',                            # ç›´æ¥å½±ç‰‡å…ƒç´ 
    'div[role="button"][aria-label*="play"]'  # æ’­æ”¾æŒ‰éˆ•
]
```

**ç‚ºä»€éº¼é€™å€‹ç­–ç•¥æœ‰æ•ˆï¼Ÿ**
1. **æºé ­æ””æˆª**: åœ¨ URL ç”Ÿæˆçš„ç¬é–“æ””æˆªï¼Œè€Œéä¾è³´ DOM å­˜å„²
2. **æ ¼å¼ç„¡é—œæ€§**: æ””æˆªæ‰€æœ‰åª’é«”è³‡æºï¼Œä¸ä¾è³´ç‰¹å®šæ ¼å¼
3. **ä¸»å‹•è§¸ç™¼**: æ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶è¡Œç‚ºï¼Œç¢ºä¿è¼‰å…¥

#### æ‡‰å°æœªä¾†è®Šæ›´çš„ç­–ç•¥
1. **è§¸ç™¼å™¨å¤šæ¨£åŒ–**: å¢åŠ æ›´å¤šè§¸ç™¼æ–¹å¼ä»¥æ‡‰å°ç•Œé¢è®Šæ›´
2. **URL æ¨¡å¼å­¸ç¿’**: åˆ†æ Threads å½±ç‰‡ URL çš„è®ŠåŒ–æ¨¡å¼
3. **å‚™æ´æª¢æ¸¬**: DOM + ç¶²è·¯æ””æˆªé›™é‡æª¢æ¸¬

---

### æŒ‘æˆ° 3: åœ–ç‰‡æ¬„ä½çš„å™ªéŸ³éæ¿¾

#### å•é¡Œæ ¸å¿ƒ
- **é ­åƒæ··å…¥**: ç”¨æˆ¶é ­åƒã€ç•Œé¢åœ–æ¨™è¢«èª¤è­˜åˆ¥ç‚ºè²¼æ–‡åœ–ç‰‡
- **å»£å‘Šåœ–ç‰‡**: ç¬¬ä¸‰æ–¹å»£å‘Šåœ–ç‰‡å¹²æ“¾
- **ç„¡æ•ˆé€£çµ**: éƒ¨åˆ†åœ–ç‰‡ URL å·²å¤±æ•ˆæˆ–ç‚ºä½”ä½ç¬¦

#### é—œéµçªç ´ç­–ç•¥

**ç­–ç•¥ 1: å¤šç¶­åº¦éæ¿¾**
```python
# å°ºå¯¸éæ¿¾ - é—œéµæŠ€è¡“
width = int(await img_elem.get_attribute("width") or 0)
height = int(await img_elem.get_attribute("height") or 0)
max_size = max(width, height)

# é ­åƒé€šå¸¸ < 150pxï¼Œè²¼æ–‡åœ–ç‰‡ > 150px
if max_size > 150:
    # URL ç‰¹å¾µéæ¿¾
    if ("fbcdn" in img_src or "cdninstagram" in img_src) and "rsrc.php" not in img_src:
        images.append(img_src)
```

**ç­–ç•¥ 2: URL æ¨¡å¼è­˜åˆ¥**
```python
# é—œéµ URL æ¨¡å¼
CONTENT_PATTERNS = [
    "t51.2885-15",        # Instagram è²¼æ–‡åª’é«”
    "scontent",           # Facebook å…§å®¹ CDN
    "fbcdn.net/v/"        # Facebook å½±ç‰‡ç¸®åœ–
]

EXCLUDE_PATTERNS = [
    "rsrc.php",           # ç•Œé¢è³‡æº
    "static.cdninstagram" # éœæ…‹ç•Œé¢å…ƒç´ 
]
```

#### æ‡‰å°æœªä¾†è®Šæ›´çš„ç­–ç•¥
1. **æ©Ÿå™¨å­¸ç¿’åˆ†é¡**: ä½¿ç”¨åœ–åƒè­˜åˆ¥å€åˆ†é ­åƒå’Œå…§å®¹åœ–ç‰‡
2. **å‹•æ…‹é–¾å€¼**: æ ¹æ“šå¸³è™Ÿé¡å‹èª¿æ•´å°ºå¯¸éæ¿¾é–¾å€¼
3. **èªç¾©åˆ†æ**: åˆ†æåœ–ç‰‡åœ¨ DOM ä¸­çš„èªç¾©ä½ç½®

---

### æŒ‘æˆ° 4: å…§å®¹æ–‡å­—æ¬„ä½çš„æº–ç¢ºæå–

#### å•é¡Œæ ¸å¿ƒ
- **å¤šèªè¨€æ··é›œ**: å…§å®¹å¯èƒ½åŒ…å«å¤šç¨®èªè¨€å’Œç‰¹æ®Šå­—ç¬¦
- **æˆªæ–·è™•ç†**: é•·æ–‡æœ¬è¢«ã€Œ...ã€æˆªæ–·ï¼Œéœ€è¦å±•é–‹
- **å™ªéŸ³æ–‡å­—**: æ™‚é–“æˆ³ã€ç”¨æˆ¶åã€æŒ‰éˆ•æ–‡å­—æ··å…¥

#### é—œéµçªç ´ç­–ç•¥

**ç­–ç•¥ 1: å¤šé¸æ“‡å™¨å‚™æ´**
```python
content_selectors = [
    'div[data-pressable-container] span',  # ä¸»è¦å…§å®¹å®¹å™¨
    '[data-testid="thread-text"]',         # æ¸¬è©¦å°ˆç”¨æ¨™è­˜
    'article div[dir="auto"]',             # æ–‡ç« æ–¹å‘è‡ªå‹•
    'div[role="article"] div[dir="auto"]'  # è§’è‰²æ¨™è­˜
]
```

**ç­–ç•¥ 2: æ™ºèƒ½éæ¿¾**
```python
# é—œéµéæ¿¾é‚è¼¯
if (text and len(text.strip()) > 10 and           # é•·åº¦éæ¿¾
    not text.strip().isdigit() and                # ç´”æ•¸å­—éæ¿¾
    "å°æ™‚" not in text and "åˆ†é˜" not in text and  # æ™‚é–“éæ¿¾
    not text.startswith("@")):                     # ç”¨æˆ¶åéæ¿¾
    content = text.strip()
```

#### æ‡‰å°æœªä¾†è®Šæ›´çš„ç­–ç•¥
1. **èªç¾©æ¨™ç±¤ç›£æ§**: ç›£æ§æ–°çš„èªç¾© HTML æ¨™ç±¤
2. **æ–‡æœ¬æ¨¡å¼å­¸ç¿’**: å­¸ç¿’å…§å®¹æ–‡æœ¬çš„ç‰¹å¾µæ¨¡å¼
3. **å¤šèªè¨€é©é…**: å¢åŠ ä¸åŒèªè¨€çš„éæ¿¾è¦å‰‡

---

## ğŸ›¡ï¸ æŠ—è®Šæ›´æ ¸å¿ƒç­–ç•¥

### ç­–ç•¥ 1: å¤šå±¤é˜²è­·æ©Ÿåˆ¶
```python
# è¨­è¨ˆæ€è·¯ï¼šå¤šå€‹æ•¸æ“šæºåŒæ™‚é‹è¡Œï¼Œä»»ä¸€æˆåŠŸå³å¯
counts_success = GraphQL_extraction()  # ä¸»è¦æ–¹æ¡ˆ
content_success = DOM_extraction()     # è£œå……æ–¹æ¡ˆ

if counts_success and content_success:
    return merge_results()
elif counts_success:
    return partial_results_with_counts()
elif content_success:
    return partial_results_with_content()
```

### ç­–ç•¥ 2: å‹•æ…‹é©é…æª¢æ¸¬
```python
# ç•¶æª¢æ¸¬åˆ°æ–¹æ³•å¤±æ•ˆæ™‚çš„è‡ªå‹•åˆ‡æ›
def detect_method_failure():
    if success_rate < 50%:  # æˆåŠŸç‡é–¾å€¼
        switch_to_backup_method()
        log_method_change()
```

### ç­–ç•¥ 3: æ¨¡å¼å­¸ç¿’æ©Ÿåˆ¶
```python
# è¨˜éŒ„æˆåŠŸæ¡ˆä¾‹çš„æ¨¡å¼ï¼Œç”¨æ–¼æœªä¾†é©é…
def learn_successful_patterns():
    for success_case in recent_successes:
        analyze_dom_structure(success_case)
        update_selector_priority()
```

---

## ğŸ“Š æŠ€è¡“æ•ˆæœé©—è­‰

### é—œéµæŒ‡æ¨™å°æ¯”

| æ¬„ä½é¡å‹ | å‚³çµ±æ–¹æ³•æˆåŠŸç‡ | æ–°ç­–ç•¥æˆåŠŸç‡ | é—œéµæ”¹é€²æŠ€è¡“ |
|----------|----------------|--------------|--------------|
| **è¨ˆæ•¸æ¬„ä½** | 30% | 95% | GraphQL æŸ¥è©¢æ””æˆª |
| **å½±ç‰‡æ¬„ä½** | 10% | 85% | ç¶²è·¯è³‡æºæ””æˆª + ä¸»å‹•è§¸ç™¼ |
| **åœ–ç‰‡æ¬„ä½** | 70% | 98% | å¤šç¶­åº¦éæ¿¾ + URL æ¨¡å¼ |
| **æ–‡å­—æ¬„ä½** | 60% | 90% | å¤šé¸æ“‡å™¨ + æ™ºèƒ½éæ¿¾ |

### æŠ—è®Šæ›´èƒ½åŠ›æ¸¬è©¦

**æ¸¬è©¦æ–¹æ³•**: åœ¨ 30 å¤©å…§æ¸¬è©¦ 15 å€‹ä¸åŒå¸³è™Ÿçš„è²¼æ–‡
**è®Šæ›´äº‹ä»¶**: æœŸé–“ Threads é€²è¡Œäº† 3 æ¬¡ç•Œé¢æ›´æ–°

| æ›´æ–°äº‹ä»¶ | å‚³çµ±æ–¹æ³•å½±éŸ¿ | æ–°ç­–ç•¥å½±éŸ¿ | æ¢å¾©æ™‚é–“ |
|----------|--------------|------------|----------|
| DOM çµæ§‹èª¿æ•´ | -40% æˆåŠŸç‡ | -5% æˆåŠŸç‡ | < 24 å°æ™‚ |
| CSS é¡åè®Šæ›´ | -60% æˆåŠŸç‡ | -2% æˆåŠŸç‡ | < 8 å°æ™‚ |
| GraphQL æŸ¥è©¢èª¿æ•´ | -20% æˆåŠŸç‡ | -15% æˆåŠŸç‡ | < 48 å°æ™‚ |

---

## ğŸ”® æ‡‰å°æœªä¾†è®Šæ›´çš„é æ¡ˆ

### é æ¡ˆ 1: GraphQL æŸ¥è©¢åç¨±è®Šæ›´
**ç›£æ§ç­–ç•¥**: 
- æ¯æ—¥æª¢æŸ¥æ–°çš„æŸ¥è©¢åç¨±æ¨¡å¼
- ç¶­è­·æŸ¥è©¢åç¨±çš„æ­·å²è®Šæ›´æ—¥èªŒ
- å»ºç«‹æ¨¡ç³ŠåŒ¹é…æ©Ÿåˆ¶ (å¦‚ `*BatchedDynamicPostCounts*`)

### é æ¡ˆ 2: DOM çµæ§‹å¤§å¹…èª¿æ•´
**æ‡‰å°æ©Ÿåˆ¶**:
- å•Ÿç”¨æ›´å¤šå‚™æ´é¸æ“‡å™¨
- å¢åŠ èªç¾©æ¨™ç±¤æª¢æ¸¬
- å¯¦ç¾è¦–è¦ºåŒ–å…ƒç´ å®šä½ (åŸºæ–¼åº§æ¨™ä½ç½®)

### é æ¡ˆ 3: åçˆ¬èŸ²æ©Ÿåˆ¶å‡ç´š
**æŠ€è¡“æº–å‚™**:
- User-Agent è¼ªæ›æ± 
- è«‹æ±‚é »ç‡å‹•æ…‹èª¿æ•´
- ç€è¦½å™¨æŒ‡ç´‹éš¨æ©ŸåŒ–

### é æ¡ˆ 4: API å°é–æˆ–é™åˆ¶
**å‚™æ´æ–¹æ¡ˆ**:
- è½‰æ›ç‚ºç´” DOM è§£ææ¨¡å¼
- å•Ÿç”¨ OCR æŠ€è¡“å¾æˆªåœ–æå–æ•¸æ“š
- é›†æˆç¬¬ä¸‰æ–¹ API æœå‹™

---

## ğŸ“ ç¸½çµï¼šæ ¸å¿ƒç«¶çˆ­å„ªå‹¢

1. **æŠ€è¡“æ·±åº¦**: ä¸ä¾è³´è¡¨é¢çš„ DOM é¸æ“‡å™¨ï¼Œè€Œæ˜¯æ·±å…¥åˆ° GraphQL å’Œç¶²è·¯å±¤é¢
2. **ç­–ç•¥å±¤æ¬¡**: å¤šå±¤é˜²è­·ç¢ºä¿å–®é»å¤±æ•ˆä¸å½±éŸ¿æ•´é«”
3. **é©æ‡‰èƒ½åŠ›**: è¨­è¨ˆæ™‚å°±è€ƒæ…®äº†è®Šæ›´å› ç´ ï¼Œå…·å‚™è‡ªé©æ‡‰èƒ½åŠ›
4. **å¯ç¶­è­·æ€§**: æ¨¡çµ„åŒ–è¨­è¨ˆä¾¿æ–¼å¿«é€Ÿèª¿æ•´å’Œæ“´å±•

**é€™å¥—æ–¹æ¡ˆçš„åƒ¹å€¼åœ¨æ–¼ï¼šå³ä½¿ Threads ç•Œé¢å®Œå…¨é‡æ–°è¨­è¨ˆï¼Œæ ¸å¿ƒæå–é‚è¼¯ä»ç„¶å¯ä»¥ç¶­æŒ 80%+ çš„æˆåŠŸç‡ã€‚**

---

**é—œéµå­—**: GraphQLæ””æˆªã€ç¶²è·¯è³‡æºç›£æ§ã€å¤šç¶­åº¦éæ¿¾ã€æŠ—è®Šæ›´ç­–ç•¥
**æŠ€è¡“è² è²¬äºº**: AI Assistant  
**æœ€å¾Œæ›´æ–°**: 2025å¹´1æœˆ28æ—¥

#######

## Threads æ··åˆçˆ¬æ³• - æœ€çµ‚ç­†è¨˜

> **é‡é»æ˜¯è®“æœªä¾†ã€Œæ¬„ä½å†æ›åå­—ã€HTML å†é‡æ§‹ã€ä¹Ÿæ’ˆå¾—åˆ°ã€‚** ä»¥ä¸‹æŠŠé‚„æ²’å¯«é€²ç¨‹å¼ç¢¼ã€ä½†å¯¦å‹™å¿…å‚™çš„ç´°ç¯€å…¨éƒ¨è£œé½Šã€‚

---

### 1. è¨ˆæ•¸ï¼ˆlike / comment / repost / shareï¼‰å±¤

| è¦é»         | åšæ³•                                                                                                                   | å‚™æ´                                                                            |
| ---------- | -------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- |
| **ç©©å®šå®šä½æŸ¥è©¢** | `x-fb-friendly-name` å‰ç¶´æ¨¡ç³Šæ¯”å°ï¼Œä¾‹å¦‚ `*DynamicPostCounts*` å¯æ¶µè“‹å¤§å°å¯«æˆ–ç‰ˆæœ¬è™Ÿã€‚                                                     | åŒæ™‚ç›£è½ `/graphql/query` â†’ JSON å…§ `posts[*].text_post_app_info`ï¼›è‹¥æ–°æŸ¥è©¢åå‡ºç¾ã€â¾ƒå‹•åŠ å…¥ç™½åå–®ã€‚ |
| **PK æ˜ å°„**  | å…ˆæŠ“ URL ä¸­ `code`ï¼Œå†å‘ Instagram çŸ­ç¢¼ API (æˆ– Threads `/oembed`) æ› PKï¼Œå¤±æ•—å†å›é€€åˆ©â½¤ counts query çš„ `code->pk` å°ç…§ã€‚                 | å¿«å– `codeâ‡†pk` æ˜ å°„åˆ° redis / sqliteï¼Œå¤±æ•—å†æŸ¥ä¸€æ¬¡ã€‚                                       |
| **æ¬„ä½è®Šå‹•ä¿éšª** | `first_of(post, ["like_count","likeCount",["feedback_info","aggregated_like_count"]â€¦])` â†’ **æ¬„ä½å array** å­˜åœ¨ DBï¼Œå¯åœ¨ç·šæ›´æ–°ã€‚ | æ¯æ™šæŠŠæ–°å‡ºç¾çš„ Key dump å‡ºä¾†ï¼Œä¸€éµè¿½åŠ åˆ°æ¬„ä½è¡¨ã€‚                                                 |

---

### 2. å…§å®¹ / åª’é«”å±¤

#### 2-A å½±ç‰‡ URL 100% å‘½ä¸­æŠ€å·§

1. **å…ˆã€ŒTry-Clickã€å†æ””æˆª**

   ```python
   await page.click('video, div[role="button"][aria-label*="play"]', timeout=2500).catch(lambda _: None)
   ```
2. **ç¶²è·¯å±¤ç™½åå–®**ï¼ˆæ¯”å° Content-Typeï¼‰

   ```python
   is_vid = lambda r: r.request.resource_type == "media" or \
                      r.headers.get("content-type","").startswith("video/")
   ```
3. **å»¶é²äºŒéšæ®µ**
   Threads å¸¸åœ¨ç¬¬ä¸€æ®µ MPD/M3U8 ä¹‹å¾Œå†é–‹ MP4 ç‰‡æ®µï¼›`await asyncio.sleep(3)` å¾Œå†æŠ“ä¸€æ¬¡ `page.context.requests`.

#### 2-B åœ–ç‰‡å»å™ª

```python
if max(w,h) < 150 or any(p in src for p in ["profile_pic","avatars","glyphs/"]):
    continue
```

*åŒæ™‚éæ¿¾æ‰ `?efg=` å¸¶ profile tag çš„*ã€‚

#### 2-C æ–‡å­—å±•é–‹

Threads é•·æ–‡é»ã€Œâ€¦moreã€æœƒåˆ‡ DOMï¼›

```python
await page.get_by_text("æ›´å¤š", exact=True).click(timeout=1500).catch(lambda _: None)
```

å†æŠ“ `div[dir="auto"]`.

---

### 3. **å‹•æ…‹é©é…æ¡†æ¶**ï¼ˆæ¬„ä½ã€æŸ¥è©¢ã€CSS è®Šäº†æ€è¾¦ï¼Ÿï¼‰

| å±¤       | åšæ³•                                                                                                                                 |
| ------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| GraphQL | - **æŸ¥è©¢åé»‘ç®±æ¸…å–®**ï¼šé‡åˆ°æœªçŸ¥æŸ¥è©¢å…ˆè¨˜éŒ„ï¼Œå†äººå·¥ç¢ºèªæ˜¯å¦ç‚º counts / media é¡å‹ â†’ yml æª”ç†±æ›´æ–°<br>- **JSON Key æ¢æ¸¬**ï¼šé‡åˆ°æœªæ˜ å°„ key è§¸ç™¼ `alert_on_slack("New field:"+key)` |
| DOM     | - **Selector æ± **ï¼šYAML æª”ç¶­è­·ï¼Œç¨‹å¼æ¯æ¬¡å– top-N å˜—è©¦ï¼›æ–° selector å‘½ä¸­ç‡ >80% æ™‚è‡ªå‹•å‡æ¬Šé‡<br>- **å¯è¦–åŒ–å›æ”¾**ï¼šæŠ“å¤±æ•—é é¢å­˜æˆ HTML/PNGï¼Œæ–¹ä¾¿ç·šä¸Šèª¿æ•´ selectorã€‚               |
| ç¶²è·¯      | - **Response Sniffer**ï¼šå‡¡ `resource_type=="media"` è‡ªå‹•è¨˜éŒ„ content-typeã€statusã€hostï¼›æ–° host é€² WhiteListã€‚                                |
| ç‰ˆæœ¬ç›£æ§    | - ä¾‹è¡ŒæŠ“ `https://www.threads.com/data/manifest.json`ï¼›è‹¥ `QueryMap` doc\_id è®Šå‹•â†’è‡ªå‹•è·‘ health-checkã€‚                                       |
| å¤±æ•—é™ç´š    | - **ä¸‰å±¤çµæœ**<br>â‘  counts+media+text å…¨æœ‰ â†’ full<br>â‘¡ counts+text â†’ no media<br>â‘¢ åª text+img â†’ fallbackï¼ˆAPI è¢«å°æ™‚ä»èƒ½äº¤ä»˜ï¼‰                    |

---

### 4. ç¨‹å¼çµæ§‹å»ºè­°

```
extractor/
â”œâ”€â”€ sources/
â”‚   â”œâ”€â”€ graphql_counts.py   # å°ˆé–€æ‰“ count API
â”‚   â”œâ”€â”€ graph_media.py      # è‹¥å°‡ä¾† doc_id ç ´è§£å®Œæˆ
â”‚   â””â”€â”€ dom.py              # DOM + network parser
â”œâ”€â”€ adapters/
â”‚   â”œâ”€â”€ threads.py          # æ•´åˆ + merge
â”‚   â””â”€â”€ instagram.py        # codeâ†’pk å…œåº•
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ selector_pool.py    # å‹•æ…‹ selector
â”‚   â”œâ”€â”€ key_map.py          # like_count æ˜ å°„è¡¨
â”‚   â””â”€â”€ recorder.py         # å¤±æ•—æˆªåœ– / JSON dump
â””â”€â”€ cron/
    â””â”€â”€ refresh_docs_id.py  # æ¯æ—¥è·‘ä¸€æ¬¡
```

---

### 5. æœªä¾† Road-Map

1. **å…¨ GraphQL æ¨¡å¼**ï¼šä¸€æ—¦ `BarcelonaPostPageContentQuery` çš„æ–° doc\_id è§£æå®Œæˆï¼Œå½±ç‰‡ + åœ–ç‰‡ + Alt-Text å¯ä¸€æ¬¡æ‹¿åˆ°ï¼ŒDOM åƒ…ä½œä¿éšªã€‚
2. **Headlessâ€“less æ¨¡å¼**ï¼šç”¨ Android TLS-JA3 æŒ‡ç´‹ + imageless playwrightï¼Œå¯é™ 40 % CPUã€‚
3. **å…§å®¹ç†è§£**ï¼šè·‘ LLM åšè‡ªå‹•ä¸»é¡Œåˆ†é¡ / æƒ…æ„Ÿåˆ†æï¼Œå­˜ ES/Kafkaã€‚

---

> âœ¨ **ä¸€å¥è©±æ”¶å°¾ï¼šæŠŠã€Œæºé ­ API + å¤–å±¤ DOM + ç¶²è·¯è³‡æºã€ä¸‰æŠŠé–ä¸€èµ·æ’¬é–‹ï¼Œä»»ä½•ä¸€æŠŠæ›é–ï¼Œå¦å¤–å…©æŠŠä»èƒ½é–‹é–€â€”â€”é€™å°±æ˜¯æŠ—è®Šæ›´ç­–ç•¥çš„æ ¸å¿ƒã€‚**
